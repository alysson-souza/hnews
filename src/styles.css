/* Import Fonts and External Styles first */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
@import 'highlight.js/styles/atom-one-dark.css';

/* Import Tailwind CSS */
@import 'tailwindcss';

/* Load legacy JavaScript config for theme values */
@config '../tailwind.config.js';
@plugin '@tailwindcss/typography';

/* Override highlight.js theme for dark mode compatibility */
@layer base {
  .dark pre {
    background-color: #1e293b !important;
    color: #e2e8f0 !important;
  }
  .dark pre code {
    background-color: #1e293b !important;
    color: #e2e8f0 !important;
  }
}

/* CSS Custom Properties for Dynamic Viewport (PWA Orientation Fix) */
:root {
  /* These are set by DeviceService and update on orientation change */
  --viewport-width: 100vw;
  --viewport-height: 100vh;
  --vh: 1vh; /* Calculated as viewport-height * 0.01 */
}

/* PWA: Prevent white flash during navigation */
html {
  background-color: #f9fafb; /* gray-50 */
  @apply transition-colors duration-200;
}

html.dark {
  background-color: #020617; /* slate-950 */
}

/* Skeleton loader utility with gentle pulse */
.skeleton {
  @apply animate-pulse motion-reduce:animate-none dark:opacity-90;
}

/* Glassmorphism utility */
@utility glass {
  @apply bg-white/50 dark:bg-slate-900/60 backdrop-blur-3xl backdrop-saturate-200 border border-white/40 dark:border-slate-700/50 shadow-xl;
  @apply transition-all duration-300;
}

/* Override the dark variant to use class selector */
@variant dark (&:where(.dark, .dark *));

/* Light mode scrollbar */
::-webkit-scrollbar {
  width: 12px;
  background-color: #f1f5f9; /* slate-100 */
}
::-webkit-scrollbar-thumb {
  background-color: #cbd5e1; /* slate-300 */
  border-radius: 6px;
}
::-webkit-scrollbar-thumb:hover {
  background-color: #94a3b8; /* slate-400 */
}

/* Dark mode scrollbar (slate-tinted) */
@media (prefers-color-scheme: dark) {
  ::-webkit-scrollbar {
    width: 12px;
    background-color: #020617; /* slate-950 */
  }
  ::-webkit-scrollbar-thumb {
    background-color: #334155; /* slate-600 */
    border-radius: 6px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: #475569; /* slate-500 */
  }
}

.dark ::-webkit-scrollbar {
  width: 12px;
  background-color: #020617;
}
.dark ::-webkit-scrollbar-thumb {
  background-color: #334155;
  border-radius: 6px;
}
.dark ::-webkit-scrollbar-thumb:hover {
  background-color: #475569;
}

/* Ensure proper text wrapping */
h1,
h2,
h3,
h4,
h5,
h6,
p,
span,
a {
  @apply break-words;
}

/* Unified form controls */
.app-input {
  @apply w-full px-3 py-2 rounded-lg border-0 ring-1 ring-gray-200 dark:ring-slate-700 outline-none;
  @apply text-gray-900 dark:text-gray-100;
  @apply placeholder-gray-500 dark:placeholder-gray-400;
  @apply bg-gray-50 dark:bg-slate-800;
  @apply focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-slate-900;
  @apply transition-all;
  @apply disabled:opacity-60 disabled:cursor-not-allowed;
}
.app-input-xs {
  @apply text-xs px-2 py-1;
}
.app-input-sm {
  @apply text-sm px-3 py-2;
}
.app-input-lg {
  @apply text-base px-4 py-3;
}

/* Validation and state styles */
.app-input[aria-invalid='true'],
.app-select[aria-invalid='true'] {
  @apply border-red-500 focus:ring-red-500;
}
.app-input[readonly],
.app-select[readonly] {
  @apply bg-gray-50 dark:bg-slate-800 cursor-default;
}

/* Selects */
.app-select {
  @apply px-3 py-2 rounded border outline-none;
  @apply text-gray-900 dark:text-gray-100;
  @apply bg-white dark:bg-slate-900;
  @apply border-gray-300 dark:border-slate-700;
  @apply focus:ring-2 focus:ring-blue-500 focus:border-transparent;
}

/* Radios and checkboxes */
.app-radio {
  @apply w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300;
}
.app-checkbox {
  @apply w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded;
}

/* Fix for long URLs and code blocks */
pre,
code {
  overflow-x: auto;
  max-width: 100%;
}

/* Code blocks should use smaller font than surrounding text */
.comment-body pre,
.comment-body code,
.item-prose pre,
.item-prose code,
.sub-comment pre,
.sub-comment code {
  @apply text-xs font-mono;
}

/* Ensure nested code in pre maintains the size */
.comment-body pre code,
.item-prose pre code,
.sub-comment pre code {
  @apply text-xs;
}

/* Code block styling */
.comment-body pre,
.item-prose pre,
.sub-comment pre {
  @apply bg-gray-100 dark:bg-gray-900 p-3 rounded my-2 overflow-x-auto;
}
.comment-body pre:first-child,
.item-prose pre:first-child,
.sub-comment pre:first-child {
  margin-top: 0;
}

/* Inline code styling */
.comment-body :not(pre) > code,
.item-prose :not(pre) > code,
.sub-comment :not(pre) > code {
  @apply bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded;
}

/* Global styling for quotes inside comment bodies (applies to innerHTML content) */
.comment-body blockquote {
  border-left-width: 4px;
  border-left-style: solid;
  border-left-color: #d1d5db; /* gray-300 */
  padding-left: 0.75rem; /* pl-3 */
  margin-top: 0.25rem;
  margin-bottom: 0;
  color: var(--tw-prose-quotes, #111827);
  font-style: italic;
  @apply text-pretty;
}
.comment-body blockquote:first-child {
  margin-top: 0;
}
.comment-body blockquote:last-child {
  margin-bottom: 0;
}
.comment-body blockquote + * {
  margin-top: 0.25rem !important;
}
.dark .comment-body blockquote {
  border-left-color: #4b5563; /* gray-600 */
  color: #d1d5db; /* gray-300 */
}
.comment-body blockquote p {
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.comment-body blockquote p:first-child {
  margin-top: 0;
}
/* Comments panel: control bottom spacing via last child margin, not card padding */
.comments-card .space-y-4 > :last-child {
  /* Last top-level thread should not add extra space beyond card padding */
  margin-bottom: 0;
}

.comments-card .space-y-4 + .mt-6 {
  /* Load-more container itself should not push the card bottom further down */
  margin-bottom: 0;
}

/* When there is no "Load more comments" section, reduce bottom padding on the
   main comments card so that the space below the last comment roughly matches
   the space above the "Comments" heading. */
.comments-card:not(:has(div.mt-6.flex.justify-center)) .card-base.card-padding {
  padding-bottom: 0.75rem; /* 12px instead of default 24px */
}

/* Distinct URL styling inside comment text and story bodies */
.comment-body a,
.item-prose a {
  /* Chip-like link appearance */
  @apply inline-flex items-center gap-1 px-1.5 py-0.5 rounded border text-sm no-underline cursor-pointer;
  @apply border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300;
  @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500;
  /* Wrapping for long URLs */
  word-break: break-word;
  overflow-wrap: anywhere;
}
.dark .comment-body a,
.dark .item-prose a {
  @apply border-slate-600 bg-slate-800 text-blue-300 hover:bg-slate-700 hover:border-slate-500;
}
.comment-body a::after,
.item-prose a::after {
  content: 'â†—';
  font-size: 0.75em;
  line-height: 1;
  margin-left: 0.25rem;
  color: #4b5563; /* slate-600 */
}
.dark .comment-body a::after,
.dark .item-prose a::after {
  color: #9ca3af; /* gray-400 */
}

/* Smaller style for domain-only links (transformed with class ext-link) */
.comment-body a.ext-link,
.item-prose a.ext-link {
  /* Force a smaller size than text-sm applied above */
  font-size: 0.75rem !important; /* text-xs */
  line-height: 1.15rem !important;
  /* Slightly tighter chip paddings */
  padding: 0.125rem 0.375rem !important; /* ~py-0.5 px-1.5 -> a bit tighter */
}
