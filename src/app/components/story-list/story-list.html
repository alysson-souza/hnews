<app-page-container
  [class.lg:w-[60vw]]="sidebarService.isOpen()"
  class="transition-all duration-300"
>
  <!-- Offline Indicator -->
  @if (isOffline()) {
    <div class="offline-indicator" role="status" aria-live="polite">
      <span class="offline-text">Showing saved results. Connect to refresh.</span>
    </div>
  }

  <!-- New Stories Indicator -->
  @if (newStoriesAvailable() > 0 && !refreshing()) {
    <button
      (click)="loadNewStories()"
      class="new-stories-indicator"
      [attr.aria-label]="
        'Load ' +
        newStoriesAvailable() +
        ' new ' +
        (newStoriesAvailable() === 1 ? 'story' : 'stories')
      "
      role="button"
    >
      {{ newStoriesAvailable() }} new {{ newStoriesAvailable() === 1 ? 'story' : 'stories' }}
    </button>
  }

  <!-- Loading State with Skeletons -->
  @if ((loading() && stories().length === 0) || refreshing()) {
    <div role="status" aria-live="polite" aria-label="Loading Stories">
      @for (i of skeletonArray; track i) {
        <app-story-item [loading]="true" />
      }
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert-error">
      <p>{{ error() }}</p>
      <button (click)="refresh()" class="alert-link">Try again</button>
    </div>
  }

  <!-- Stories List -->
  <div class="stories-space">
    @for (story of stories(); track story.id; let i = $index) {
      <app-story-item
        [story]="story"
        [loading]="false"
        [index]="i + 1"
        [isSelected]="keyboardNavService.selectedIndex() === i"
        [attr.data-story-index]="i"
        [attr.data-story-id]="story.id"
      />
    }
  </div>

  <!-- Offline empty state (no cached stories) -->
  @if (isOffline() && stories().length === 0 && !loading()) {
    <div class="empty">
      <p>No saved results</p>
    </div>
  }

  <!-- Load More Button -->
  @if (hasMore() && !loading()) {
    <div class="text-center mt-8">
      <button (click)="loadMore()" class="load-more-btn" aria-label="Load More Stories">
        Load More Stories
      </button>
    </div>
  }

  <!-- Loading More Indicator -->
  @if (loading() && stories().length > 0) {
    <div class="loading-wrap">
      <div class="loading-spin"></div>
      <span class="loading-text">Loading more stories...</span>
    </div>
  }

  <!-- No More Stories -->
  @if (!hasMore() && stories().length > 0) {
    <div class="empty">
      <p>No more stories to load</p>
    </div>
  }
</app-page-container>
