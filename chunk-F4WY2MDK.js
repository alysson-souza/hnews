import{a as $}from"./chunk-SZSAZDHJ.js";import{b as H}from"./chunk-77LKTX5Y.js";import{e as N,h as z,k as V}from"./chunk-WSP23YN7.js";import"./chunk-SXXLH57T.js";import"./chunk-NINWBLK3.js";import{a as A}from"./chunk-ALJNL3AC.js";import{$a as c,Aa as S,Ab as y,Ba as w,Bb as d,Ea as m,Ib as L,Ma as P,Mb as g,_,_b as D,ab as u,bb as T,cb as k,da as f,db as E,ea as v,eb as C,fa as M,fb as o,gb as a,hb as x,lb as b,na as p,nb as I,pb as l,zb as r}from"./chunk-A2HHJ6P6.js";var F=t=>["/user",t];function O(t,n){t&1&&(o(0,"div",0),x(1,"div",2)(2,"div",3),o(3,"div",4),x(4,"div",5)(5,"div",5),a()())}function j(t,n){if(t&1&&(o(0,"a",8),r(1),a()),t&2){let e=l(2);C("href",e.item().url,w),m(),d(" ",e.item().title," ")}}function q(t,n){if(t&1&&r(0),t&2){let e=l(2);d(" ",e.item().title," ")}}function R(t,n){if(t&1&&x(0,"div",11),t&2){let e=l(2);C("innerHTML",e.item().text,S)}}function G(t,n){if(t&1&&x(0,"app-comment-thread",15),t&2){let e=n.$implicit,i=n.$index,s=l(3);C("commentId",e)("depth",0)("lazyLoad",s.shouldLazyLoad(i))}}function U(t,n){t&1&&(o(0,"span",18),M(),o(1,"svg",19),x(2,"circle",20)(3,"path",21),a(),r(4," Loading... "),a())}function J(t,n){if(t&1&&r(0),t&2){let e=l(4);d(" Load ",e.nextBatchSize()," more comments ")}}function K(t,n){if(t&1){let e=b();o(0,"div",16)(1,"button",17),I("click",function(){f(e);let s=l(3);return v(s.loadMoreComments())}),c(2,U,5,0,"span",18)(3,J,1,1),a()()}if(t&2){let e=l(3);m(),C("disabled",e.loadingMoreComments()),m(),u(e.loadingMoreComments()?2:3)}}function Q(t,n){if(t&1&&(o(0,"div",4),k(1,G,1,3,"app-comment-thread",15,T),a(),c(3,K,4,2,"div",16)),t&2){let e=l(2);m(),E(e.visibleComments()),m(2),u(e.hasMoreComments()?3:-1)}}function W(t,n){t&1&&(o(0,"p",14),r(1,"No comments yet"),a())}function X(t,n){if(t&1&&(o(0,"div",6)(1,"h1",7),c(2,j,2,2,"a",8)(3,q,1,1),a(),o(4,"div",9)(5,"span"),r(6),a(),o(7,"span"),r(8,"\u2022"),a(),o(9,"span"),r(10,"by "),o(11,"a",10),r(12),a()(),o(13,"span"),r(14,"\u2022"),a(),o(15,"span"),r(16),a(),o(17,"span"),r(18,"\u2022"),a(),o(19,"span"),r(20),a()(),c(21,R,1,1,"div",11),a(),o(22,"div",12)(23,"h2",13),r(24),a(),c(25,Q,4,1)(26,W,2,0,"p",14),a()),t&2){let e=l();m(2),u(e.item().url?2:3),m(4),d("",e.item().score||0," points"),m(5),C("routerLink",L(9,F,e.item().by)),m(),d(" ",e.item().by," "),m(4),y(e.getTimeAgo(e.item().time)),m(4),d("",e.item().descendants||0," comments"),m(),u(e.item().text?21:-1),m(3),d(" Comments (",e.item().descendants||0,") "),m(),u(e.visibleComments().length>0?25:26)}}function Y(t,n){if(t&1){let e=b();o(0,"div",1)(1,"p",22),r(2),a(),o(3,"button",23),I("click",function(){f(e);let s=l();return v(s.loadItem())}),r(4," Try Again "),a()()}if(t&2){let e=l();m(2),y(e.error())}}var B=class t{route=_(N);hnService=_(V);visitedService=_(H);item=p(null);loading=p(!0);error=p(null);commentsPerPage=10;immediateLoadCount=3;maxInitialComments=3;currentCommentsPage=p(0);loadingMoreComments=p(!1);visibleComments=g(()=>{let n=this.item();if(!n?.kids)return[];if(this.currentCommentsPage()===0)return n.kids.slice(0,this.maxInitialComments);let e=this.maxInitialComments+this.currentCommentsPage()*this.commentsPerPage;return n.kids.slice(0,e)});hasMoreComments=g(()=>{let n=this.item();if(!n?.kids)return!1;let e=n.kids.length;return(this.currentCommentsPage()===0?this.maxInitialComments:this.maxInitialComments+this.currentCommentsPage()*this.commentsPerPage)<e});remainingCommentsCount=g(()=>{let n=this.item();if(!n?.kids)return 0;let e=n.kids.length,i=this.currentCommentsPage()===0?this.maxInitialComments:this.maxInitialComments+this.currentCommentsPage()*this.commentsPerPage;return Math.max(0,e-i)});nextBatchSize=g(()=>Math.min(this.commentsPerPage,this.remainingCommentsCount()));shouldLazyLoad(n){return n>=this.immediateLoadCount}ngOnInit(){this.route.params.subscribe(n=>{let e=n.id;e?this.loadItem(+e):this.route.queryParams.subscribe(i=>{let s=i.id;s&&this.loadItem(+s)})})}loadItem(n){let e=n||+this.route.snapshot.params.id;if(!e){this.error.set("Invalid item ID"),this.loading.set(!1);return}this.loading.set(!0),this.error.set(null),this.currentCommentsPage.set(0),this.hnService.getItem(e).subscribe({next:i=>{i?(this.item.set(i),this.visitedService.markAsVisited(i.id,i.descendants)):this.error.set("Item not found"),this.loading.set(!1)},error:()=>{this.error.set("Failed to load item. Please try again."),this.loading.set(!1)}})}loadMoreComments(){this.loadingMoreComments()||!this.hasMoreComments()||(this.loadingMoreComments.set(!0),setTimeout(()=>{this.currentCommentsPage.update(n=>n+1),this.loadingMoreComments.set(!1)},300))}getTimeAgo(n){let e=Math.floor(Date.now()/1e3-n),i=Math.floor(e/60),s=Math.floor(i/60),h=Math.floor(s/24);return h>0?`${h} day${h>1?"s":""} ago`:s>0?`${s} hour${s>1?"s":""} ago`:i>0?`${i} minute${i>1?"s":""} ago`:"just now"}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=P({type:t,selectors:[["app-item"]],decls:4,vars:1,consts:[[1,"animate-pulse"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","text-center"],[1,"h-8","bg-gray-200","rounded","w-3/4","mb-4"],[1,"h-4","bg-gray-200","rounded","w-1/2","mb-8"],[1,"space-y-4"],[1,"h-20","bg-gray-200","rounded"],[1,"bg-white","rounded-lg","shadow-sm","p-6","mb-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],["target","_blank","rel","noopener noreferrer nofollow",1,"hover:text-blue-600",3,"href"],[1,"flex","items-center","gap-3","text-sm","text-gray-600","mb-4"],[1,"text-blue-600","hover:underline",3,"routerLink"],[1,"prose","prose-lg","max-w-none","text-gray-800","mb-4",3,"innerHTML"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"text-gray-500","text-center","py-8"],[3,"commentId","depth","lazyLoad"],[1,"mt-8","text-center"],[1,"px-6","py-3","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:bg-blue-400","disabled:cursor-not-allowed","transition-colors","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500",3,"click","disabled"],[1,"flex","items-center","gap-2"],["fill","none","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-red-800"],[1,"mt-4","px-4","py-2","bg-red-600","text-white","rounded","hover:bg-red-700",3,"click"]],template:function(e,i){e&1&&(o(0,"app-page-container"),c(1,O,6,0,"div",0)(2,X,27,11)(3,Y,5,1,"div",1),a()),e&2&&(m(),u(i.loading()?1:i.item()?2:i.error()?3:-1))},dependencies:[D,$,z,A],encapsulation:2})};export{B as ItemComponent};
