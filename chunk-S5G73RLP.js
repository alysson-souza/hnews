import{i as I}from"./chunk-SRDQ2QLC.js";import{a as O}from"./chunk-SXXLH57T.js";import{a as D,b as U,e as A,j as N}from"./chunk-NINWBLK3.js";import{$a as _,Bb as C,Db as w,Ea as l,Eb as E,Fb as S,Ib as k,Ma as T,V as b,_ as h,_a as d,_b as M,ab as v,da as a,ea as s,eb as V,fb as m,gb as c,lb as x,na as f,nb as p,pb as r,wb as y,zb as g}from"./chunk-A2HHJ6P6.js";var F=class o{STORAGE_KEY="hn_visited_stories";MAX_VISITED=1e3;visitedMap=new Map;constructor(){this.loadVisited()}loadVisited(){try{let t=localStorage.getItem(this.STORAGE_KEY);t&&JSON.parse(t).forEach(i=>this.visitedMap.set(i.storyId,i))}catch(t){console.error("Failed to load visited stories:",t)}}saveVisited(){try{let t=Array.from(this.visitedMap.values()).sort((e,i)=>i.visitedAt-e.visitedAt).slice(0,this.MAX_VISITED);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Failed to save visited stories:",t)}}markAsVisited(t,e){let i=this.visitedMap.get(t),n={storyId:t,visitedAt:Date.now(),commentCount:e??i?.commentCount};this.visitedMap.set(t,n),this.saveVisited()}isVisited(t){return this.visitedMap.has(t)}getVisitedData(t){return this.visitedMap.get(t)}hasNewComments(t,e){let i=this.visitedMap.get(t);return!i||i.commentCount===void 0?!1:e>i.commentCount}getNewCommentCount(t,e){let i=this.visitedMap.get(t);return!i||i.commentCount===void 0?0:Math.max(0,e-i.commentCount)}clearVisited(){this.visitedMap.clear(),localStorage.removeItem(this.STORAGE_KEY)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"})};var G=o=>["/user",o];function K(o,t){if(o&1){let e=x();m(0,"button",5),p("click",function(n){a(e);let u=r();return s(u.startEdit(n))})("keyup.enter",function(n){a(e);let u=r();return s(u.startEdit(n))})("keyup.space",function(n){a(e);let u=r();return s(u.startEdit(n))}),g(1),c()}if(o&2){let e=r();y("background-color",e.tag().color),d("aria-label","Tag: "+e.tag().tag),l(),C(" ",e.tag().tag," ")}}function P(o,t){if(o&1){let e=x();m(0,"button",6),p("click",function(n){a(e);let u=r();return s(u.startEdit(n))}),g(1," [+] "),c()}if(o&2){let e=r();d("aria-label","Add tag for "+e.username)}}function Y(o,t){if(o&1){let e=x();m(0,"button",10),p("click",function(){a(e);let n=r(2);return s(n.removeTag())}),g(1," \u2717 "),c()}o&2&&d("aria-label","Remove tag")}function j(o,t){if(o&1){let e=x();m(0,"div",1)(1,"input",7,0),S("ngModelChange",function(n){a(e);let u=r();return E(u.editValue,n)||(u.editValue=n),s(n)}),p("keyup.enter",function(){a(e);let n=r();return s(n.saveTag())})("keyup.escape",function(){a(e);let n=r();return s(n.cancelEdit())})("blur",function(){a(e);let n=r();return s(n.onInputBlur())}),c(),m(3,"button",8),p("mousedown",function(){a(e);let n=r();return s(n.saveTag())}),g(4," \u2713 "),c(),_(5,Y,2,1,"button",9),c()}if(o&2){let e=r();l(),w("ngModel",e.editValue),d("aria-label","Enter tag for "+e.username),l(2),d("aria-label","Save tag"),l(2),v(e.tag()?5:-1)}}var R=class o{username;tagsService=h(O);tag=f(this.tagsService.getTag(this.username));editing=f(!1);editValue="";ngOnInit(){this.tag.set(this.tagsService.getTag(this.username))}startEdit(t){t.preventDefault(),t.stopPropagation(),this.editing.set(!0),this.editValue=this.tag()?.tag||"",setTimeout(()=>{let e=document.querySelector('input[aria-label*="'+this.username+'"]');e?.focus(),e?.select()},0)}saveTag(){let t=this.editValue.trim();t?(this.tagsService.setTag(this.username,t),this.tag.set(this.tagsService.getTag(this.username))):this.tag()&&(this.tagsService.removeTag(this.username),this.tag.set(void 0)),this.editing.set(!1),this.editValue=""}removeTag(){this.tagsService.removeTag(this.username),this.tag.set(void 0),this.editing.set(!1),this.editValue=""}onInputBlur(){setTimeout(()=>{this.editing()&&this.cancelEdit()},100)}cancelEdit(){this.editing.set(!1),this.editValue=""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-user-tag"]],inputs:{username:"username"},decls:6,vars:8,consts:[["tagInput",""],[1,"inline-flex","items-center","gap-1"],[1,"text-blue-600","hover:underline","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"routerLink"],["type","button",1,"px-1.5","py-0.5","text-xs","text-white","rounded","cursor-pointer",3,"background-color"],[1,"text-gray-400","hover:text-gray-600","text-xs","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1"],["type","button",1,"px-1.5","py-0.5","text-xs","text-white","rounded","cursor-pointer",3,"click","keyup.enter","keyup.space"],[1,"text-gray-400","hover:text-gray-600","text-xs","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1",3,"click"],["type","text","placeholder","Tag...",1,"px-1","py-0","text-xs","border","border-gray-300","rounded","w-20","focus:outline-none","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","keyup.enter","keyup.escape","blur","ngModel"],[1,"text-green-600","hover:text-green-800","text-xs","cursor-pointer",3,"mousedown"],[1,"text-red-600","hover:text-red-800","text-xs","cursor-pointer"],[1,"text-red-600","hover:text-red-800","text-xs","cursor-pointer",3,"click"]],template:function(e,i){e&1&&(m(0,"span",1)(1,"a",2),g(2),c(),_(3,K,2,4,"button",3),_(4,P,2,1,"button",4),_(5,j,6,4,"div",1),c()),e&2&&(l(),V("routerLink",k(6,G,i.username)),d("aria-label","View profile of "+i.username),l(),C(" ",i.username," "),l(),v(i.tag()&&!i.editing()?3:-1),l(),v(!i.tag()&&!i.editing()?4:-1),l(),v(i.editing()?5:-1))},dependencies:[M,N,D,U,A,I],encapsulation:2})};export{R as a,F as b};
