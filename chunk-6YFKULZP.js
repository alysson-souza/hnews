import{a as Wt,c as ct,d as Zt,e as Xt}from"./chunk-4S26V4BJ.js";import{a as jt,b as Kt}from"./chunk-MRT4NG24.js";import{b as Rt,d as Ft,e as zt,h as qt}from"./chunk-RUJMMPOU.js";import{a as Yt}from"./chunk-R4JXISVT.js";import{b as $t,c as Ht,d as Bt}from"./chunk-6R2GPWYH.js";import"./chunk-FRAC5L3Y.js";import{a as Qt}from"./chunk-UGM2JKJI.js";import{$ as g,$a as U,A as Pt,B as ot,Cb as rt,D as nt,Da as V,Db as Vt,E as A,Ia as Tt,Lb as Nt,Pb as R,Q as I,Qa as N,R as Dt,Ra as b,Rb as Ut,S as kt,Sa as k,Sb as Gt,Ta as Lt,Ua as _t,Va as xt,W as q,Wa as _,Xa as c,Xb as lt,Ya as p,Za as T,_a as P,a as L,ab as F,bb as S,c as D,cb as Z,da as m,db as x,ea as u,eb as X,f as Mt,fa as Y,fb as d,ga as Ct,i as Ot,jb as J,kb as tt,l as M,lb as et,m as f,ma as C,nb as Et,oa as It,ob as z,q as j,qb as w,r as E,rb as at,s as O,sb as G,ta as B,tb as st,xa as s,yb as At,z as bt}from"./chunk-YMVQ6C4T.js";var dt=class n{queues=new Map;limits={hackernews:{maxRequests:30,windowMs:6e4},algolia:{maxRequests:100,windowMs:6e4},microlink:{maxRequests:50,windowMs:24*60*60*1e3},linkpreview:{maxRequests:60,windowMs:60*60*1e3},opengraphio:{maxRequests:10,windowMs:60*1e3}};throttle(e,t){return D(this,null,function*(){let r=this.limits[e]||{maxRequests:10,windowMs:6e4};this.queues.has(e)||this.queues.set(e,{timestamps:[],pending:[]});let i=this.queues.get(e),o=Date.now();if(i.timestamps=i.timestamps.filter(v=>o-v<r.windowMs),i.timestamps.length<r.maxRequests)return i.timestamps.push(o),t();let l=i.timestamps[0]+r.windowMs-o;return new Promise((v,h)=>{setTimeout(()=>D(this,null,function*(){try{let y=yield this.throttle(e,t);v(y)}catch(y){h(y)}}),l)})})}isNearLimit(e){let t=this.limits[e];if(!t)return!1;let r=this.queues.get(e);if(!r)return!1;let i=Date.now();return r.timestamps.filter(a=>i-a<t.windowMs).length>=t.maxRequests*.8}getUsageStats(e){let t=this.limits[e];if(!t)return{current:0,max:0,resetIn:0};let r=this.queues.get(e);if(!r||r.timestamps.length===0)return{current:0,max:t.maxRequests,resetIn:0};let i=Date.now(),o=r.timestamps.filter(v=>i-v<t.windowMs),a=o[0]||i,l=Math.max(0,a+t.windowMs-i);return{current:o.length,max:t.maxRequests,resetIn:l}}throttleBatch(e,t){return D(this,null,function*(){let r=[];for(let i of t){let o=yield this.throttle(e,i);r.push(o)}return r})}getAvailableCapacity(e){let t=this.limits[e];if(!t)return 0;let r=this.queues.get(e);if(!r)return t.maxRequests;let i=Date.now(),o=r.timestamps.filter(a=>i-a<t.windowMs);return Math.max(0,t.maxRequests-o.length)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};var pt=class{constructor(e,t,r,i,o){this.http=e;this.rateLimiter=t;this.apiConfig=r;this.quota=i;this.fallbacks=o}name="microlink";isEnabled(){let e=this.apiConfig.microlink?.apiKey;return e==="free"||typeof e=="string"&&e.length>0}fetch(e){let t=`${this.apiConfig.microlink?.apiUrl||"https://api.microlink.io"}/?url=${encodeURIComponent(e)}`,r=new Ut,i=this.apiConfig.microlink?.apiKey;return i&&i!=="free"&&(r=r.set("x-api-key",i)),M(this.quota.tryConsume("microlink","day",50)).pipe(I(o=>o?M(this.rateLimiter.throttle("microlink",()=>j(this.http.get(t,{headers:r})))).pipe(E(8e3),O(a=>{if(a.status==="success"&&a.data){let l=a.data;return{title:l.title||"",description:l.description||"",image:l.image?.url||l.screenshot?.url||"",siteName:l.publisher||"",favicon:l.logo?.url||this.fallbacks.getSafeFaviconUrl(e)||this.fallbacks.FALLBACK_ICON,url:l.url||e}}return this.toDefault(e)}),A(()=>f(this.toDefault(e)))):f(this.toDefault(e))))}toDefault(e){return{title:"",description:"",image:"",siteName:this.getDomain(e),favicon:this.fallbacks.getSafeFaviconUrl(e)||this.fallbacks.FALLBACK_ICON,url:e}}getDomain(e){if(!e)return"";try{return new URL(e).hostname.replace("www.","")}catch{return""}}};var ht=class{constructor(e,t,r,i,o){this.http=e;this.rateLimiter=t;this.apiConfig=r;this.quota=i;this.fallbacks=o}name="linkpreview";isEnabled(){let e=this.apiConfig.linkpreview?.apiKey;return!!(e&&e!=="free")}fetch(e){let t=this.apiConfig.linkpreview?.apiKey;if(!t||t==="free")return f(this.toDefault(e));let i=`${this.apiConfig.linkpreview?.apiUrl||"https://api.linkpreview.net"}/?key=${encodeURIComponent(t)}&q=${encodeURIComponent(e)}`;return M(this.quota.tryConsume("linkpreview","hour",60)).pipe(I(o=>o?M(this.rateLimiter.throttle("linkpreview",()=>j(this.http.get(i)))).pipe(E(8e3),O(a=>{if(a&&!a.error){let l=a.url||e;return{title:a.title||"",description:a.description||"",image:a.image||"",siteName:this.getDomain(l),favicon:this.fallbacks.getSafeFaviconUrl(l)||this.fallbacks.FALLBACK_ICON,url:l}}return this.toDefault(e)}),A(()=>f(this.toDefault(e)))):f(this.toDefault(e))))}toDefault(e){return{title:"",description:"",image:"",siteName:this.getDomain(e),favicon:this.fallbacks.getSafeFaviconUrl(e)||this.fallbacks.FALLBACK_ICON,url:e}}getDomain(e){if(!e)return"";try{return new URL(e).hostname.replace("www.","")}catch{return""}}};var gt=class{constructor(e,t,r,i,o){this.http=e;this.rateLimiter=t;this.apiConfig=r;this.quota=i;this.fallbacks=o}name="opengraphio";mutex=Promise.resolve();isEnabled(){return!!this.apiConfig.opengraphio?.appId}fetch(e){let t=this.apiConfig.opengraphio?.appId;if(!t)return f(this.toDefault(e));let i=`${this.apiConfig.opengraphio?.apiUrl||"https://opengraph.io/api/1.1/site"}/${encodeURIComponent(e)}?app_id=${encodeURIComponent(t)}`;return M(this.runExclusive(()=>D(this,null,function*(){return(yield this.quota.tryConsume("opengraphio","month",100))?this.rateLimiter.throttle("opengraphio",()=>j(this.http.get(i))):this.toDefault(e)}))).pipe(E(8e3),O(o=>{if(!o)return this.toDefault(e);if(this.isOgResponse(o)){let a=o,l=a.openGraph||{},v=this.extractImageUrl(l),h=l.url||a.requestInfo?.url||e;return Object.keys(l).length>0?{title:l.title||"",description:l.description||"",image:v||"",siteName:l.site_name||this.getDomain(h),favicon:this.fallbacks.getSafeFaviconUrl(h)||this.fallbacks.FALLBACK_ICON,url:h}:this.toDefault(e)}else return o}),A(()=>f(this.toDefault(e))))}runExclusive(e){let t,r=this.mutex;return this.mutex=new Promise(i=>t=i),r.catch(()=>{}).then(()=>D(this,null,function*(){try{return yield e()}finally{t()}}))}isOgResponse(e){if(!e||typeof e!="object")return!1;let t=e;return"openGraph"in t||"requestInfo"in t}extractImageUrl(e){let t=e?.image;return t?typeof t=="string"?t:typeof t=="object"&&"url"in t&&t.url||"":""}toDefault(e){return{title:"",description:"",image:"",siteName:this.getDomain(e),favicon:this.fallbacks.getSafeFaviconUrl(e)||this.fallbacks.FALLBACK_ICON,url:e}}getDomain(e){if(!e)return"";try{return new URL(e).hostname.replace("www.","")}catch{return""}}};var mt=class n{cache=g(lt);tryConsume(e,t,r){return D(this,null,function*(){try{let i=new Date,o=t==="hour"?`${i.getUTCFullYear()}-${String(i.getUTCMonth()+1).padStart(2,"0")}-${String(i.getUTCDate()).padStart(2,"0")}-H${String(i.getUTCHours()).padStart(2,"0")}`:t==="day"?`${i.getUTCFullYear()}-${String(i.getUTCMonth()+1).padStart(2,"0")}-${String(i.getUTCDate()).padStart(2,"0")}`:`${i.getUTCFullYear()}-${String(i.getUTCMonth()+1).padStart(2,"0")}`,a=`quota_${e}_${t}_${o}`,l=(yield this.cache.get("apiCache",a))||0;if(l>=r)return!1;let v;t==="hour"?v=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours()+1)):t==="day"?v=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+1)):v=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth()+1,1));let h=Math.max(1e3,v.getTime()-i.getTime());return yield this.cache.set("apiCache",a,l+1,h),!0}catch{return!0}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};var K=class n{http=g(Gt);cache=g(lt);rateLimiter=g(dt);apiConfig=g(Wt);quota=g(mt);userSettings=g(Yt);failedUrls=new Set;MAX_RETRIES=3;retryCount=new Map;FALLBACK_ICON="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSI+CiAgPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iOCIgZmlsbD0iI0U1RTdFQiIvPgogIDxwYXRoIGQ9Ik0yOCAyMGg4bC00IDEyaDRsLTggMTIgMi0xMGgtNGwyLTE0eiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K";getOpenGraphData(e){return e?this.failedUrls.has(e)?f(this.getDefaultData(e)):M(this.cache.get("opengraph",e)).pipe(I(t=>{if(t)return f(t);let r=this.retryCount.get(e)||0;return r>=this.MAX_RETRIES?(this.failedUrls.add(e),f(this.getDefaultData(e))):(this.retryCount.set(e,r+1),this.fetchViaProviders(e).pipe(E(1e4),I(i=>(this.retryCount.delete(e),M(this.cache.set("opengraph",e,i)).pipe(O(()=>i)))),A(i=>{console.warn(`OpenGraph fetch failed for ${e} (attempt ${r+1}):`,i),r+1>=this.MAX_RETRIES&&this.failedUrls.add(e);let o=this.getDefaultData(e);return M(this.cache.set("opengraph",e,o)).pipe(O(()=>o))})))})):f(this.getDefaultData(e))}fetchViaProviders(e){let t=this.buildProviders();if(t.length===0)return f(this.getDefaultData(e));let r=700,i=t.map((o,a)=>bt(a*r).pipe(I(()=>o.fetch(e).pipe(E(8e3),A(()=>f(void 0))))));return new Mt(o=>{let a=!1,l=i.map(h=>h.subscribe({next:y=>{!a&&y&&(y.title||y.description||y.image)&&(a=!0,o.next(y),o.complete())},error:()=>{},complete:()=>{}})),v=setTimeout(()=>{a||(a=!0,o.next(this.getDefaultData(e)),o.complete())},9e3);return()=>{clearTimeout(v),l.forEach(h=>h.unsubscribe())}})}buildProviders(){let e={getSafeFaviconUrl:l=>this.getSafeFaviconUrl(l),FALLBACK_ICON:this.FALLBACK_ICON},t=this.mergeApiConfig(this.apiConfig,this.userSettings.getApiConfigOverrides()),r=new ht(this.http,this.rateLimiter,t,this.quota,e),i=new pt(this.http,this.rateLimiter,t,this.quota,e),o=new gt(this.http,this.rateLimiter,t,this.quota,e),a=[];return r.isEnabled()&&a.push(r),i.isEnabled()&&a.push(i),o.isEnabled()&&a.push(o),a}mergeApiConfig(e,t){let r={microlink:L({},e?.microlink||{}),linkpreview:L({},e?.linkpreview||{}),opengraphio:L({},e?.opengraphio||{})};return t?.microlink&&(r.microlink=L(L({},r.microlink),t.microlink)),t?.linkpreview&&(r.linkpreview=L(L({},r.linkpreview),t.linkpreview)),t?.opengraphio&&(r.opengraphio=L(L({},r.opengraphio),t.opengraphio)),r}getDefaultData(e){return{title:"",description:"",image:"",siteName:this.getDomain(e),favicon:this.getSafeFaviconUrl(e)||this.FALLBACK_ICON,url:e}}getDomain(e){if(!e)return"";try{return new URL(e).hostname.replace("www.","")}catch{return""}}getSafeFaviconUrl(e){if(!e)return this.FALLBACK_ICON;let t=this.getDomain(e);return t?this.failedUrls.has(e)?this.FALLBACK_ICON:t.includes("localhost")||t.includes("127.0.0.1")||t.includes("0.0.0.0")||t.length<3?this.FALLBACK_ICON:`https://www.google.com/s2/favicons?domain=${t}&sz=64`:this.FALLBACK_ICON}getOpenGraphDataBatch(e){if(!e||e.length===0)return f(new Map);let t=[...new Set(e.filter(r=>r&&r.length>0))];return M(Promise.all(t.map(r=>this.cache.get("opengraph",r).then(i=>({url:r,cached:i}))))).pipe(I(r=>{let i=new Map,o=[];if(r.forEach(({url:h,cached:y})=>{y?i.set(h,y):o.push(h)}),o.length===0)return f(i);let a=8,l=[];for(let h=0;h<o.length;h+=a)l.push(o.slice(h,h+a));let v=l.map(h=>{let y=h.map((H,te)=>{let ee=te*200;return bt(ee).pipe(I(()=>this.getOpenGraphData(H).pipe(E(12e3),O(yt=>{let W=new Map;return W.set(H,yt),W}),A(yt=>{console.warn(`Individual request failed for ${H}:`,yt);let W=new Map;return W.set(H,this.getDefaultData(H)),f(W)}))))});return ot(...y)});return ot(f(i),ot(...v))}))}getOpenGraphDataViaProxy(e){return this.getOpenGraphData(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};function re(n,e){n&1&&(P(0,"div",1),Y(),P(1,"svg",4),F(2,"path",5),U()())}function ie(n,e){n&1&&F(0,"div",2)}function oe(n,e){if(n&1){let t=S();P(0,"a",6),X("click",function(){m(t);let i=d();return u(i.handleLinkClick())}),P(1,"img",7),X("error",function(i){m(t);let o=d();return u(o.handleImageError(i))}),U()()}if(n&2){let t=d();Z("href",t.storyUrl,B),s(),Z("src",t.ogData.image,B)("alt","Thumbnail for "+t.storyTitle)}}function ne(n,e){if(n&1){let t=S();P(0,"a",6),X("click",function(){m(t);let i=d();return u(i.handleLinkClick())}),P(1,"img",8),X("error",function(i){m(t);let o=d();return u(o.handleImageError(i))}),U()()}if(n&2){let t=d();Z("href",t.storyUrl,B),s(),Z("src",(t.ogData==null?null:t.ogData.favicon)||"/assets/default-thumb.svg",B)("alt","Favicon for "+t.storyTitle)}}var ut=class n{storyUrl;storyTitle="";ogData;loading=!1;isTextPost=!1;linkClicked=new Tt;handleLinkClick(){this.linkClicked.emit()}handleImageError(e){let t=e.target;t.src="/assets/default-thumb.svg"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["app-story-thumbnail"]],inputs:{storyUrl:"storyUrl",storyTitle:"storyTitle",ogData:"ogData",loading:"loading",isTextPost:"isTextPost"},outputs:{linkClicked:"linkClicked"},decls:5,vars:1,consts:[[1,"thumb"],[1,"thumb-placeholder"],[1,"thumb-skeleton"],["target","_blank","rel","noopener noreferrer nofollow",1,"thumb-link",3,"href"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"],["target","_blank","rel","noopener noreferrer nofollow",1,"thumb-link",3,"click","href"],["loading","lazy",1,"thumb-img-cover",3,"error","src","alt"],["decoding","async",1,"thumb-img-contain",3,"error","src","alt"]],template:function(t,r){t&1&&(P(0,"div",0),b(1,re,3,0,"div",1)(2,ie,1,0,"div",2)(3,oe,2,3,"a",3)(4,ne,2,3,"a",3),U()),t&2&&(s(),k(r.isTextPost?1:r.loading?2:r.ogData!=null&&r.ogData.image?3:4))},dependencies:[R],styles:[`@layer properties;.thumb[_ngcontent-%COMP%]{position:relative;height:calc(var(--spacing, .25rem) * 20);width:calc(var(--spacing, .25rem) * 20);overflow:hidden;border-radius:var(--radius-md, .375rem);border-style:var(--tw-border-style);border-width:1px;border-color:var(--color-gray-200, oklch(92.8% .006 264.531));background-color:var(--color-gray-100, oklch(96.7% .003 264.542))}.thumb[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-slate-800, oklch(27.9% .041 260.031))}.thumb[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:var(--color-slate-700, oklch(37.2% .044 257.287))}.thumb-link[_ngcontent-%COMP%]{display:block;height:100%;width:100%;transition-property:opacity;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.thumb-link[_ngcontent-%COMP%]:hover{opacity:90%}}.thumb-img-cover[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover}.thumb-img-contain[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:contain}.thumb-placeholder[_ngcontent-%COMP%]{display:flex;height:100%;width:100%;align-items:center;justify-content:center}.thumb-skeleton[_ngcontent-%COMP%]{height:100%;width:100%;animation:var(--animate-pulse, _ngcontent-%COMP%_pulse 2s cubic-bezier(.4, 0, .6, 1) infinite);background-color:var(--color-gray-200, oklch(92.8% .006 264.531))}.thumb-skeleton[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:var(--color-slate-800, oklch(27.9% .041 260.031))}@property --tw-border-style{syntax: "*"; inherits: false; initial-value: solid;}@keyframes _ngcontent-%COMP%_pulse{50%{opacity:.5}}@layer properties{@supports ((-webkit-hyphens: none) and (not (margin-trim: inline))) or ((-moz-orient: inline) and (not (color:rgb(from red r g b)))){*[_ngcontent-%COMP%], [_ngcontent-%COMP%]:before, [_ngcontent-%COMP%]:after, [_ngcontent-%COMP%]::backdrop{--tw-border-style: solid}}}

`]})};var Q=class n{userAgent=C(navigator.userAgent);windowWidth=C(window.innerWidth);constructor(){window.addEventListener("resize",()=>{this.windowWidth.set(window.innerWidth)})}isMobile(){return this.windowWidth()<640}isTablet(){return this.windowWidth()>=640&&this.windowWidth()<1024}isDesktop(){return this.windowWidth()>=1024}isMacOS(){return/Mac|iPhone|iPad|iPod/.test(this.userAgent())}getModifierKey(){return this.isMacOS()?"Cmd":"Ctrl"}shouldShowKeyboardHints(){return this.isDesktop()}getDeviceType(){return this.isMobile()?"mobile":this.isTablet()?"tablet":"desktop"}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};var ae=["actionsBtn"],se=["actionsMenu"],le=n=>["/item",n];function ce(n,e){n&1&&T(0,"div",3),n&2&&_("title","You Have Visited This Story")}function de(n,e){if(n&1){let t=S();c(0,"div",4)(1,"button",26),x("click",function(){m(t);let i=d();return u(i.upvote())}),Y(),c(2,"svg",27),T(3,"path",28),p()(),Ct(),c(4,"span",29),w(5),p()()}if(n&2){let t=d();s(),z("vote-button-active",!t.hasVoted())("vote-button-voted",t.hasVoted()),_("disabled",t.hasVoted())("title",t.hasVoted()?"Already Upvoted":"Upvote Story"),N("aria-label",t.hasVoted()?"Already Upvoted":"Upvote Story")("aria-pressed",t.hasVoted()),s(3),z("vote-count-active",!t.hasVoted())("vote-count-voted",t.hasVoted()),s(),G(" ",(t.story.score||0)+(t.hasVoted()?1:0)," ")}}function pe(n,e){if(n&1){let t=S();c(0,"div",5)(1,"button",26),x("click",function(){m(t);let i=d();return u(i.upvote())}),Y(),c(2,"svg",30),T(3,"path",28),p()(),Ct(),c(4,"span",31),w(5),p()()}if(n&2){let t=d();s(),z("vote-button-active",!t.hasVoted())("vote-button-voted",t.hasVoted()),_("disabled",t.hasVoted())("title",t.hasVoted()?"Already Upvoted":"Upvote Story"),N("aria-label",t.hasVoted()?"Already Upvoted":"Upvote Story")("aria-pressed",t.hasVoted()),s(3),z("vote-count-active",!t.hasVoted())("vote-count-voted",t.hasVoted()),s(),G(" ",(t.story.score||0)+(t.hasVoted()?1:0)," ")}}function he(n,e){if(n&1){let t=S();c(0,"a",32),x("click",function(){m(t);let i=d();return u(i.markAsVisited())}),w(1),p()}if(n&2){let t=d();_("href",t.story.url,B),s(),G(" ",t.story.title," ")}}function ge(n,e){if(n&1){let t=S();c(0,"a",33),x("click",function(){m(t);let i=d();return u(i.markAsVisited())}),w(1),p()}if(n&2){let t=d();_("routerLink",At(2,le,t.story.id)),s(),G(" ",t.story.title," ")}}function me(n,e){if(n&1){let t=S();c(0,"button",34),x("click",function(i){m(t);let o=d();return u(o.searchByDomain(i))})("keyup.enter",function(i){m(t);let o=d();return u(o.searchByDomain(i))})("keyup.space",function(i){m(t);let o=d();return u(o.searchByDomain(i))}),w(1),p()}if(n&2){let t,r=d();_("title","Search For More Stories From "+r.getDomain(r.story.url)),N("aria-label","Search For More Stories From "+r.getDomain(r.story.url)),s(),G(" (",((t=r.ogDataSignal())==null?null:t.siteName)||r.getDomain(r.story.url),") ")}}function ue(n,e){if(n&1&&(c(0,"p",15),w(1),p()),n&2){let t=d();s(),G(" ",t.ogDataSignal().description," ")}}function ve(n,e){if(n&1&&(c(0,"span",17),w(1," by "),T(2,"app-user-tag",35),p()),n&2){let t=d();s(2),_("username",t.story.by)}}function we(n,e){if(n&1&&(c(0,"span",21),w(1),p()),n&2){let t=d();s(),G("[+",t.getNewCommentCount(),"]")}}function fe(n,e){if(n&1){let t=S();c(0,"div",36,1)(2,"button",37),x("click",function(){m(t);let i=d();return u(i.shareStory())}),w(3),p(),c(4,"button",38),x("click",function(){m(t);let i=d();return u(i.shareComments())}),w(5),p(),c(6,"button",39),x("click",function(){m(t);let i=d();return u(i.openCommentsInNewTab())}),w(7," Open Comments in New Tab "),p()()}if(n&2){let t=d();Et("top",t.actionsMenuTop,"px")("left",t.actionsMenuLeft,"px"),N("id","actions-menu-"+t.story.id)("aria-labelledby","actions-btn-"+t.story.id),s(3),G(" ",t.getStoryActionText()," "),s(2),G(" ",t.getCommentsActionText()," ")}}var wt=class n{story;index=0;ogData;isSelected=!1;votedItems=C(new Set);ogService=g(K);router=g(Ft);visitedService=g(Kt);sidebarService=g(ct);deviceService=g(Q);locationStrategy=g(Nt);ogDataSignal=C(null);loadingOg=C(!0);faEllipsisVertical=Bt;constructor(){let e=localStorage.getItem("votedItems");e&&this.votedItems.set(new Set(JSON.parse(e)))}ngOnInit(){this.ogData?(this.ogDataSignal.set(this.ogData),this.loadingOg.set(!1)):this.story?.url&&!this.isTextPost()?(this.loadingOg.set(!0),this.ogService.getOpenGraphData(this.story.url).subscribe({next:e=>{this.ogDataSignal.set(e),this.loadingOg.set(!1)},error:()=>{this.loadingOg.set(!1)}})):this.loadingOg.set(!1)}hasVoted=rt(()=>this.votedItems().has(this.story?.id||0));getDomain(e){if(!e)return"";try{return new URL(e).hostname.replace("www.","")}catch{return""}}getTimeAgo(e){let t=Math.floor(Date.now()/1e3-e),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);return o>0?`${o} day${o>1?"s":""} ago`:i>0?`${i} hour${i>1?"s":""} ago`:r>0?`${r} minute${r>1?"s":""} ago`:"just now"}upvote(){if(this.hasVoted())return;let e=new Set(this.votedItems());e.add(this.story.id),this.votedItems.set(e),localStorage.setItem("votedItems",JSON.stringify(Array.from(e)))}isTextPost(){let e=this.story?.title||"";return!this.story?.url||e.startsWith("Ask HN:")||e.startsWith("Tell HN:")||e.startsWith("Show HN:")&&!this.story?.url}searchByDomain(e){e.preventDefault(),e.stopPropagation();let t=this.getDomain(this.story.url);t&&this.router.navigate(["/search"],{queryParams:{q:`site:${t}`}})}showActionsMenu=!1;copiedStory=!1;copiedComments=!1;actionsBtn;actionsMenu;actionsMenuTop=0;actionsMenuLeft=0;canUseWebShare=rt(()=>"share"in navigator&&typeof navigator.share=="function");getStoryActionText=rt(()=>this.copiedStory?"\u2713 Copied!":this.canUseWebShare()?"Share Story":"Copy Story Link");getCommentsActionText=rt(()=>this.copiedComments?"\u2713 Copied!":this.canUseWebShare()?"Share Comments":"Copy Comments Link");isVisited(){return this.visitedService.isVisited(this.story.id)}hasNewComments(){return this.visitedService.hasNewComments(this.story.id,this.story.descendants||0)}getNewCommentCount(){return this.visitedService.getNewCommentCount(this.story.id,this.story.descendants||0)}markAsVisited(){this.visitedService.markAsVisited(this.story.id,this.story.descendants)}toggleActionsMenu(e){e.preventDefault(),e.stopPropagation(),this.showActionsMenu=!this.showActionsMenu,this.showActionsMenu&&(setTimeout(()=>{let t=this.actionsBtn?.nativeElement,r=this.actionsMenu?.nativeElement;if(!t)return;let i=t.getBoundingClientRect(),o=8,a=r?.offsetWidth??256,l=r?.offsetHeight??0,v=window.innerWidth-a-o,h=o,y=i.right-a;this.actionsMenuLeft=Math.max(h,Math.min(v,y));let St=window.innerHeight-l-o,H=i.bottom+o;this.actionsMenuTop=Math.max(o,Math.min(St,H))},0),setTimeout(()=>{let t=r=>{r.target.closest(".story-actions-container")||(this.showActionsMenu=!1,document.removeEventListener("click",t))};document.addEventListener("click",t)},0))}shareStory(){return D(this,null,function*(){let e=this.story.url||`https://news.ycombinator.com/item?id=${this.story.id}`,t={title:this.story.title,url:e};if(navigator.share&&this.canShare(t))try{yield navigator.share(t),this.showActionsMenu=!1;return}catch(r){r.name!=="AbortError"&&console.log("Share failed, falling back to clipboard")}navigator.clipboard.writeText(e).then(()=>{this.copiedStory=!0,this.copiedComments=!1,setTimeout(()=>{this.copiedStory=!1,this.showActionsMenu=!1},1500)}).catch(r=>{console.error("Failed to copy: ",r)})})}shareComments(){return D(this,null,function*(){let e=`${window.location.origin}/item/${this.story.id}`,t={title:`${this.story.title} - Comments`,text:"Discussion on HNews",url:e};if(navigator.share&&this.canShare(t))try{yield navigator.share(t),this.showActionsMenu=!1;return}catch(r){r.name!=="AbortError"&&console.log("Share failed, falling back to clipboard")}navigator.clipboard.writeText(e).then(()=>{this.copiedComments=!0,this.copiedStory=!1,setTimeout(()=>{this.copiedComments=!1,this.showActionsMenu=!1},1500)}).catch(r=>{console.error("Failed to copy: ",r)})})}openCommentsInNewTab(){let e=this.locationStrategy.prepareExternalUrl(`/item/${this.story.id}`),t=`${window.location.origin}${e}`;window.open(t,"_blank"),this.showActionsMenu=!1}canShare(e){let t=navigator;return typeof t.canShare=="function"?t.canShare(e):!0}openComments(e){if(!this.deviceService.isDesktop()){this.router.navigate(["/item",this.story.id]),this.markAsVisited();return}let t=e.shiftKey,r=e.metaKey,i=e.ctrlKey;if(t||r||i){let o=this.locationStrategy.prepareExternalUrl(`/item/${this.story.id}`),a=`${window.location.origin}${o}`;window.open(a,"_blank")}else e.preventDefault(),this.sidebarService.toggleSidebar(this.story.id),this.markAsVisited()}getCommentTooltip(){return this.deviceService.shouldShowKeyboardHints()?`View Comments (${this.deviceService.getModifierKey()}+Click for New Tab)`:"View Comments"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["app-story-item"]],viewQuery:function(t,r){if(t&1&&(J(ae,5),J(se,5)),t&2){let i;tt(i=et())&&(r.actionsBtn=i.first),tt(i=et())&&(r.actionsMenu=i.first)}},inputs:{story:"story",index:"index",ogData:"ogData",isSelected:"isSelected"},decls:30,vars:31,consts:[["actionsBtn",""],["actionsMenu",""],["role","article",1,"story-card"],[1,"visited-indicator",3,"title"],[1,"vote-section-mobile","flex","items-center","gap-2"],[1,"vote-section","flex","flex-col","w-[100px]","flex-shrink-0"],[1,"hidden","sm:flex","flex-shrink-0","w-28","items-center","justify-center","p-3"],[3,"linkClicked","storyUrl","storyTitle","ogData","loading","isTextPost"],[1,"flex-1","p-3","min-w-0","overflow-hidden"],[1,"flex","items-start","justify-between","gap-2"],[1,"flex-1","min-w-0","overflow-hidden"],[1,"story-title"],["target","_blank","rel","noopener noreferrer nofollow",1,"story-title-link","story-link-trigger","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"href"],[1,"story-title-link","story-link-trigger","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"routerLink"],["type","button",1,"domain-btn",3,"title"],[1,"story-desc"],[1,"story-meta","mt-2","overflow-hidden"],[1,"inline-flex","items-center","gap-1"],["aria-hidden","true",1,"hidden","sm:inline"],[1,"story-time"],["type","button",1,"story-comments","story-comments-trigger","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","keyup.enter","keyup.space","title"],[1,"new-comments-badge"],[1,"story-actions-container","relative","ml-2","sm:ml-0","flex-shrink-0"],[1,"story-actions-btn",3,"click","title"],[1,"text-[16px]","sm:text-[20px]",3,"icon"],["role","menu",1,"story-actions-menu","story-actions-menu-fixed",3,"top","left"],[1,"vote-button",3,"click","disabled","title"],["fill","currentColor","viewBox","0 0 20 20","aria-hidden","true",1,"w-6","h-6"],["d","M10 3L3 10h4v7h6v-7h4L10 3z"],[1,"vote-count","text-xl"],["fill","currentColor","viewBox","0 0 20 20","aria-hidden","true",1,"w-8","h-8"],[1,"vote-count","text-2xl"],["target","_blank","rel","noopener noreferrer nofollow",1,"story-title-link","story-link-trigger","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","href"],[1,"story-title-link","story-link-trigger","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","routerLink"],["type","button",1,"domain-btn",3,"click","keyup.enter","keyup.space","title"],[3,"username"],["role","menu",1,"story-actions-menu","story-actions-menu-fixed"],["role","menuitem",1,"story-actions-item","story-actions-item-top",3,"click"],["role","menuitem",1,"story-actions-item",3,"click"],["role","menuitem",1,"story-actions-item","story-actions-divider","story-actions-item-bottom",3,"click"]],template:function(t,r){if(t&1){let i=S();c(0,"article",2),b(1,ce,1,1,"div",3),b(2,de,6,13,"div",4)(3,pe,6,13,"div",5),c(4,"div",6)(5,"app-story-thumbnail",7),x("linkClicked",function(){return m(i),u(r.markAsVisited())}),p()(),c(6,"div",8)(7,"div",9)(8,"div",10)(9,"h2",11),b(10,he,2,2,"a",12)(11,ge,2,4,"a",13),p(),b(12,me,2,3,"button",14),b(13,ue,2,1,"p",15),c(14,"div",16),b(15,ve,3,1,"span",17),c(16,"span",18),w(17,"\u2022"),p(),c(18,"span",19),w(19),p(),c(20,"span",18),w(21,"\u2022"),p(),c(22,"button",20),x("click",function(a){return m(i),u(r.openComments(a))})("keyup.enter",function(a){return m(i),u(r.openComments(a))})("keyup.space",function(a){return m(i),u(r.openComments(a))}),w(23),b(24,we,2,1,"span",21),p()()(),c(25,"div",22)(26,"button",23,0),x("click",function(a){return m(i),u(r.toggleActionsMenu(a))}),T(28,"fa-icon",24),p(),b(29,fe,8,8,"div",25),p()()()()}if(t&2){let i;z("story-card-selected",r.isSelected),s(),k(r.isVisited()?1:-1),s(),k(r.deviceService.isMobile()?2:3),s(3),_("storyUrl",r.story.url)("storyTitle",r.story.title||"")("ogData",r.ogDataSignal())("loading",r.loadingOg())("isTextPost",r.isTextPost()),s(4),z("story-title-unread",!r.isVisited())("story-title-visited",r.isVisited()),s(),k(r.story.url?10:11),s(2),k(r.story.url&&r.getDomain(r.story.url)?12:-1),s(),k((i=r.ogDataSignal())!=null&&i.description?13:-1),s(2),k(r.story.by?15:-1),s(4),at(r.getTimeAgo(r.story.time)),s(3),_("title",r.getCommentTooltip()),N("aria-label","View "+(r.story.descendants||0)+" Comments"),s(),st(" ",r.story.descendants||0," ",r.story.descendants===1?"comment":"comments"," "),s(),k(r.hasNewComments()?24:-1),s(2),_("title","More Actions"),N("aria-label","Open Actions Menu")("aria-haspopup","menu")("aria-expanded",r.showActionsMenu)("aria-controls","actions-menu-"+r.story.id)("id","actions-btn-"+r.story.id),s(2),_("icon",r.faEllipsisVertical),s(),k(r.showActionsMenu?29:-1)}},dependencies:[R,zt,ut,jt,Ht,$t],styles:[`@layer properties;.story-card[_ngcontent-%COMP%]{position:relative;margin-bottom:calc(var(--spacing, .25rem) * 3);display:flex;flex-direction:column;overflow:hidden;border-radius:var(--radius-lg, .5rem);border-style:var(--tw-border-style);border-width:1px;border-color:var(--color-gray-200, oklch(92.8% .006 264.531));background-color:var(--color-white, #fff);--tw-shadow: 0 1px 3px 0 var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 1px 2px -1px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);transition-property:box-shadow;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s));--tw-duration: .2s;transition-duration:.2s}@media (hover: hover){.story-card[_ngcontent-%COMP%]:hover{--tw-shadow: 0 4px 6px -1px var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 2px 4px -2px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}@media (width >= 40rem){.story-card[_ngcontent-%COMP%]{flex-direction:row}}.story-card[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-slate-700, oklch(37.2% .044 257.287))}.story-card[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:var(--color-slate-800, oklch(27.9% .041 260.031))}.story-card[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-shadow: 0 4px 6px -1px var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 2px 4px -2px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}@media (hover: hover){.story-card[_ngcontent-%COMP%]:where(.dark,.dark *):hover{--tw-shadow: 0 10px 15px -3px var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 4px 6px -4px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.story-card-selected[_ngcontent-%COMP%]{border-color:var(--color-blue-500, oklch(62.3% .214 259.815));--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815));background-color:var(--color-blue-50, oklch(97% .014 254.604))}.story-card-selected[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-blue-400, oklch(70.7% .165 254.624))}.story-card-selected[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-ring-color: var(--color-blue-400, oklch(70.7% .165 254.624))}.story-card-selected[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:color-mix(in srgb,oklch(37.9% .146 265.522) 20%,transparent)}@supports (color: color-mix(in lab,red,red)){.story-card-selected[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:color-mix(in oklab,var(--color-blue-900, oklch(37.9% .146 265.522)) 20%,transparent)}}.vote-section[_ngcontent-%COMP%]{display:flex;width:100px;flex-shrink:0;align-items:center;justify-content:center;border-top-left-radius:var(--radius-lg, .5rem);border-bottom-left-radius:var(--radius-lg, .5rem);--tw-gradient-position: to bottom in oklab;background-image:linear-gradient(var(--tw-gradient-stops));--tw-gradient-from: var(--color-blue-50, oklch(97% .014 254.604));--tw-gradient-to: var(--color-blue-100, oklch(93.2% .032 255.585));--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position));padding-inline:calc(var(--spacing, .25rem) * 4);padding-block:calc(var(--spacing, .25rem) * 3);@screen md{width: 72px; min-width: 72px; max-width: 72px; padding-left: 2px; padding-right: 2px;}}.vote-section[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-position: to bottom in oklab;background-image:linear-gradient(var(--tw-gradient-stops))}.vote-section[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-from: #2D4373;--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position))}.vote-section[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-to: #3B5998;--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position))}.vote-section-mobile[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:flex-start;overflow:hidden;border-top-left-radius:var(--radius-lg, .5rem);border-top-right-radius:var(--radius-lg, .5rem);--tw-gradient-position: to right in oklab;background-image:linear-gradient(var(--tw-gradient-stops));--tw-gradient-from: var(--color-blue-50, oklch(97% .014 254.604));--tw-gradient-to: var(--color-blue-100, oklch(93.2% .032 255.585));--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position));padding-inline:calc(var(--spacing, .25rem) * 3);padding-block:calc(var(--spacing, .25rem) * 3)}.vote-section-mobile[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-position: to right in oklab;background-image:linear-gradient(var(--tw-gradient-stops))}.vote-section-mobile[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-from: #2D4373;--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position))}.vote-section-mobile[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-gradient-to: #3B5998;--tw-gradient-stops: var(--tw-gradient-via-stops, var(--tw-gradient-position), var(--tw-gradient-from) var(--tw-gradient-from-position), var(--tw-gradient-to) var(--tw-gradient-to-position))}.vote-button[_ngcontent-%COMP%]{cursor:pointer;border-radius:.25rem;padding:calc(var(--spacing, .25rem) * 1);transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.vote-button[_ngcontent-%COMP%]:hover{--tw-scale-x: 110%;--tw-scale-y: 110%;--tw-scale-z: 110%;scale:var(--tw-scale-x) var(--tw-scale-y)}}.vote-button[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.vote-button[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.vote-button[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}.vote-button-active[_ngcontent-%COMP%]{color:var(--color-blue-600, oklch(54.6% .245 262.881))}.vote-button-active[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-blue-400, oklch(70.7% .165 254.624))}.vote-button-voted[_ngcontent-%COMP%]{color:var(--color-gray-400, oklch(70.7% .022 261.325));opacity:50%}.vote-button-voted[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.vote-count[_ngcontent-%COMP%]{--tw-font-weight: var(--font-weight-bold, 700);font-weight:var(--font-weight-bold, 700)}.vote-count-active[_ngcontent-%COMP%]{color:var(--color-blue-600, oklch(54.6% .245 262.881))}.vote-count-active[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-blue-400, oklch(70.7% .165 254.624))}.vote-count-voted[_ngcontent-%COMP%]{color:var(--color-gray-500, oklch(55.1% .027 264.364))}.vote-count-voted[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.story-content[_ngcontent-%COMP%]{min-width:calc(var(--spacing, .25rem) * 0);flex:1;overflow:hidden;padding:calc(var(--spacing, .25rem) * 3)}.story-title[_ngcontent-%COMP%]{margin-bottom:calc(var(--spacing, .25rem) * 1);font-size:var(--text-base, 1rem);line-height:var(--tw-leading, var(--text-base--line-height, 1.5 ));--tw-font-weight: var(--font-weight-semibold, 600);font-weight:var(--font-weight-semibold, 600);overflow-wrap:break-word}@media (width >= 40rem){.story-title[_ngcontent-%COMP%]{font-size:var(--text-lg, 1.125rem);line-height:var(--tw-leading, var(--text-lg--line-height, calc(1.75 / 1.125)))}}.story-title-unread[_ngcontent-%COMP%]{color:var(--color-gray-900, oklch(21% .034 264.665))}.story-title-unread[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-100, oklch(96.7% .003 264.542))}.story-title-visited[_ngcontent-%COMP%]{color:var(--color-gray-800, oklch(27.8% .033 256.848))}.story-title-visited[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-200, oklch(92.8% .006 264.531))}.story-title-link[_ngcontent-%COMP%]{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.story-title-link[_ngcontent-%COMP%]:hover{color:var(--color-blue-600, oklch(54.6% .245 262.881))}}@media (hover: hover){.story-title-link[_ngcontent-%COMP%]:where(.dark,.dark *):hover{color:var(--color-blue-400, oklch(70.7% .165 254.624))}}.story-desc[_ngcontent-%COMP%]{margin-top:calc(var(--spacing, .25rem) * 1);display:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)));color:var(--color-gray-600, oklch(44.6% .03 256.802))}@media (width >= 40rem){.story-desc[_ngcontent-%COMP%]{display:block}}.story-desc[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-300, oklch(87.2% .01 258.338))}.story-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:calc(var(--spacing, .25rem) * 2);font-size:var(--text-xs, .75rem);line-height:var(--tw-leading, var(--text-xs--line-height, calc(1 / .75)));--tw-leading: 1;line-height:1;white-space:nowrap;color:var(--color-gray-600, oklch(44.6% .03 256.802))}@media (width >= 40rem){.story-meta[_ngcontent-%COMP%]{font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)))}}.story-meta[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.story-points[_ngcontent-%COMP%]{--tw-font-weight: var(--font-weight-medium, 500);font-weight:var(--font-weight-medium, 500)}.story-points-high[_ngcontent-%COMP%]{color:var(--color-orange-600, oklch(64.6% .222 41.116))}.story-points-high[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-orange-400, oklch(75% .183 55.934))}.story-author[_ngcontent-%COMP%]{cursor:pointer;--tw-font-weight: var(--font-weight-medium, 500);font-weight:var(--font-weight-medium, 500);transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.story-author[_ngcontent-%COMP%]:hover{color:var(--color-blue-600, oklch(54.6% .245 262.881))}}@media (hover: hover){.story-author[_ngcontent-%COMP%]:where(.dark,.dark *):hover{color:var(--color-blue-400, oklch(70.7% .165 254.624))}}.author-link[_ngcontent-%COMP%]{cursor:pointer;color:var(--color-blue-600, oklch(54.6% .245 262.881))}@media (hover: hover){.author-link[_ngcontent-%COMP%]:hover{text-decoration-line:underline}}.author-link[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-blue-300, oklch(80.9% .105 251.813))}.story-time[_ngcontent-%COMP%]{color:var(--color-gray-500, oklch(55.1% .027 264.364))}.story-time[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.story-comments[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer;align-items:center;color:var(--color-blue-600, oklch(54.6% .245 262.881));transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.story-comments[_ngcontent-%COMP%]:hover{text-decoration-line:underline}}.story-comments[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-blue-300, oklch(80.9% .105 251.813))}.story-meta[_ngcontent-%COMP%]   app-user-tag[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.new-comments-badge[_ngcontent-%COMP%]{margin-left:calc(var(--spacing, .25rem) * 1);font-size:var(--text-xs, .75rem);line-height:var(--tw-leading, var(--text-xs--line-height, calc(1 / .75)));color:var(--color-gray-500, oklch(55.1% .027 264.364))}.new-comments-badge[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.story-domain[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--color-gray-500, oklch(55.1% .027 264.364))}@media (width >= 40rem){.story-domain[_ngcontent-%COMP%]{max-width:200px}}.story-domain[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.domain-btn[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;font-size:var(--text-xs, .75rem);line-height:var(--tw-leading, var(--text-xs--line-height, calc(1 / .75)));word-break:break-all;color:var(--color-gray-500, oklch(55.1% .027 264.364))}@media (hover: hover){.domain-btn[_ngcontent-%COMP%]:hover{color:var(--color-blue-600, oklch(54.6% .245 262.881))}}@media (hover: hover){.domain-btn[_ngcontent-%COMP%]:hover{text-decoration-line:underline}}@media (width >= 40rem){.domain-btn[_ngcontent-%COMP%]{font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)))}}.domain-btn[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}@media (hover: hover){.domain-btn[_ngcontent-%COMP%]:where(.dark,.dark *):hover{color:var(--color-blue-300, oklch(80.9% .105 251.813))}}.story-actions-btn[_ngcontent-%COMP%]{cursor:pointer;border-radius:.25rem;padding:calc(var(--spacing, .25rem) * 1);color:var(--color-gray-500, oklch(55.1% .027 264.364));transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s))}@media (hover: hover){.story-actions-btn[_ngcontent-%COMP%]:hover{background-color:var(--color-gray-100, oklch(96.7% .003 264.542))}}@media (hover: hover){.story-actions-btn[_ngcontent-%COMP%]:hover{color:var(--color-blue-600, oklch(54.6% .245 262.881))}}.story-actions-btn[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.story-actions-btn[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.story-actions-btn[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}@media (width >= 40rem){.story-actions-btn[_ngcontent-%COMP%]{padding:calc(var(--spacing, .25rem) * 2)}}.story-actions-btn[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}@media (hover: hover){.story-actions-btn[_ngcontent-%COMP%]:where(.dark,.dark *):hover{background-color:var(--color-slate-800, oklch(27.9% .041 260.031))}}@media (hover: hover){.story-actions-btn[_ngcontent-%COMP%]:where(.dark,.dark *):hover{color:var(--color-blue-300, oklch(80.9% .105 251.813))}}.story-actions-menu[_ngcontent-%COMP%]{z-index:20;width:calc(var(--spacing, .25rem) * 64);border-radius:var(--radius-lg, .5rem);border-style:var(--tw-border-style);border-width:1px;border-color:var(--color-gray-200, oklch(92.8% .006 264.531));background-color:var(--color-white, #fff);--tw-shadow: 0 10px 15px -3px var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 4px 6px -4px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.story-actions-menu[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-slate-700, oklch(37.2% .044 257.287))}.story-actions-menu[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:var(--color-slate-900, oklch(20.8% .042 265.755))}.story-actions-menu[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-shadow: 0 25px 50px -12px var(--tw-shadow-color, rgb(0 0 0 / .25));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.story-actions-menu-fixed[_ngcontent-%COMP%]{position:fixed}.story-actions-item[_ngcontent-%COMP%]{width:100%;cursor:pointer;padding-inline:calc(var(--spacing, .25rem) * 4);padding-block:calc(var(--spacing, .25rem) * 2);text-align:left;font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)));color:var(--color-gray-700, oklch(37.3% .034 259.733))}@media (hover: hover){.story-actions-item[_ngcontent-%COMP%]:hover{background-color:var(--color-gray-100, oklch(96.7% .003 264.542))}}.story-actions-item[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.story-actions-item[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.story-actions-item[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}.story-actions-item[_ngcontent-%COMP%]:focus-visible{--tw-ring-inset: inset}.story-actions-item[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-200, oklch(92.8% .006 264.531))}@media (hover: hover){.story-actions-item[_ngcontent-%COMP%]:where(.dark,.dark *):hover{background-color:var(--color-slate-800, oklch(27.9% .041 260.031))}}.story-actions-item-top[_ngcontent-%COMP%]{border-top-left-radius:var(--radius-lg, .5rem);border-top-right-radius:var(--radius-lg, .5rem)}.story-actions-divider[_ngcontent-%COMP%]{border-top-style:var(--tw-border-style);border-top-width:1px;border-color:var(--color-gray-200, oklch(92.8% .006 264.531))}.story-actions-divider[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-slate-700, oklch(37.2% .044 257.287))}.story-actions-item-bottom[_ngcontent-%COMP%]{border-bottom-right-radius:var(--radius-lg, .5rem);border-bottom-left-radius:var(--radius-lg, .5rem)}.visited-indicator[_ngcontent-%COMP%]{position:absolute;top:calc(var(--spacing, .25rem) * 0);right:calc(var(--spacing, .25rem) * 0);height:calc(var(--spacing, .25rem) * 0);width:calc(var(--spacing, .25rem) * 0);border-top-style:var(--tw-border-style);border-top-width:20px;border-left-style:var(--tw-border-style);border-left-width:20px;border-top-color:var(--color-blue-600, oklch(54.6% .245 262.881));border-left-color:transparent}.visited-indicator[_ngcontent-%COMP%]:where(.dark,.dark *){border-top-color:var(--color-blue-500, oklch(62.3% .214 259.815))}.story-tag[_ngcontent-%COMP%]{border-radius:calc(infinity * 1px);padding-inline:calc(var(--spacing, .25rem) * 2);padding-block:calc(var(--spacing, .25rem) * .5);font-size:var(--text-xs, .75rem);line-height:var(--tw-leading, var(--text-xs--line-height, calc(1 / .75)));color:var(--color-white, #fff)}@property --tw-border-style{syntax: "*"; inherits: false; initial-value: solid;}@property --tw-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-shadow-color{syntax: "*"; inherits: false;}@property --tw-shadow-alpha{syntax: "<percentage>"; inherits: false; initial-value: 100%;}@property --tw-inset-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-inset-shadow-color{syntax: "*"; inherits: false;}@property --tw-inset-shadow-alpha{syntax: "<percentage>"; inherits: false; initial-value: 100%;}@property --tw-ring-color{syntax: "*"; inherits: false;}@property --tw-ring-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-inset-ring-color{syntax: "*"; inherits: false;}@property --tw-inset-ring-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-ring-inset{syntax: "*"; inherits: false;}@property --tw-ring-offset-width{syntax: "<length>"; inherits: false; initial-value: 0px;}@property --tw-ring-offset-color{syntax: "*"; inherits: false; initial-value: #fff;}@property --tw-ring-offset-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-duration{syntax: "*"; inherits: false;}@property --tw-gradient-position{syntax: "*"; inherits: false;}@property --tw-gradient-from{syntax: "<color>"; inherits: false; initial-value: #0000;}@property --tw-gradient-via{syntax: "<color>"; inherits: false; initial-value: #0000;}@property --tw-gradient-to{syntax: "<color>"; inherits: false; initial-value: #0000;}@property --tw-gradient-stops{syntax: "*"; inherits: false;}@property --tw-gradient-via-stops{syntax: "*"; inherits: false;}@property --tw-gradient-from-position{syntax: "<length-percentage>"; inherits: false; initial-value: 0%;}@property --tw-gradient-via-position{syntax: "<length-percentage>"; inherits: false; initial-value: 50%;}@property --tw-gradient-to-position{syntax: "<length-percentage>"; inherits: false; initial-value: 100%;}@property --tw-scale-x{syntax: "*"; inherits: false; initial-value: 1;}@property --tw-scale-y{syntax: "*"; inherits: false; initial-value: 1;}@property --tw-scale-z{syntax: "*"; inherits: false; initial-value: 1;}@property --tw-font-weight{syntax: "*"; inherits: false;}@property --tw-leading{syntax: "*"; inherits: false;}@layer properties{@supports ((-webkit-hyphens: none) and (not (margin-trim: inline))) or ((-moz-orient: inline) and (not (color:rgb(from red r g b)))){*[_ngcontent-%COMP%], [_ngcontent-%COMP%]:before, [_ngcontent-%COMP%]:after, [_ngcontent-%COMP%]::backdrop{--tw-border-style: solid;--tw-shadow: 0 0 #0000;--tw-shadow-color: initial;--tw-shadow-alpha: 100%;--tw-inset-shadow: 0 0 #0000;--tw-inset-shadow-color: initial;--tw-inset-shadow-alpha: 100%;--tw-ring-color: initial;--tw-ring-shadow: 0 0 #0000;--tw-inset-ring-color: initial;--tw-inset-ring-shadow: 0 0 #0000;--tw-ring-inset: initial;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-offset-shadow: 0 0 #0000;--tw-duration: initial;--tw-gradient-position: initial;--tw-gradient-from: #0000;--tw-gradient-via: #0000;--tw-gradient-to: #0000;--tw-gradient-stops: initial;--tw-gradient-via-stops: initial;--tw-gradient-from-position: 0%;--tw-gradient-via-position: 50%;--tw-gradient-to-position: 100%;--tw-scale-x: 1;--tw-scale-y: 1;--tw-scale-z: 1;--tw-font-weight: initial;--tw-leading: initial}}}

`]})};var ft=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["app-story-skeleton"]],decls:17,vars:0,consts:[[1,"relative","flex","bg-white","dark:bg-slate-800","border","border-gray-200","dark:border-slate-700","rounded-lg","shadow-sm","dark:shadow-md","mb-3","animate-pulse"],[1,"flex","flex-col","items-center","justify-center","px-4","py-3","bg-gradient-to-b","from-gray-100","to-gray-200","rounded-l-lg","w-[100px]","flex-shrink-0"],[1,"w-8","h-8","bg-gray-300","rounded","mb-2"],[1,"w-12","h-6","bg-gray-300","rounded"],[1,"flex-shrink-0","w-28","flex","items-center","justify-center","p-3"],[1,"w-20","h-20","bg-gray-200"],[1,"flex-1","p-3"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"h-5","bg-gray-200","rounded","w-3/4","mb-2"],[1,"h-4","bg-gray-200","rounded","w-32","mb-2"],[1,"h-4","bg-gray-200","rounded","w-full","mb-3"],[1,"flex","items-center","gap-3"],[1,"h-3","bg-gray-200","rounded","w-20"],[1,"h-3","bg-gray-200","rounded","w-24"],[1,"h-3","bg-gray-200","rounded","w-28"],[1,"w-9","h-9","bg-gray-200","rounded"]],template:function(t,r){t&1&&(P(0,"article",0)(1,"div",1),F(2,"div",2)(3,"div",3),U(),P(4,"div",4),F(5,"div",5),U(),P(6,"div",6)(7,"div",7)(8,"div",8),F(9,"div",9)(10,"div",10)(11,"div",11),P(12,"div",12),F(13,"div",13)(14,"div",14)(15,"div",15),U()(),F(16,"div",16),U()()())},dependencies:[R],encapsulation:2})};var ye=(n,e)=>e.id;function be(n,e){if(n&1){let t=S();c(0,"button",9),x("click",function(){m(t);let i=d();return u(i.loadNewStories())}),w(1),p()}if(n&2){let t=d();N("aria-label","Load "+t.newStoriesAvailable()+" new "+(t.newStoriesAvailable()===1?"story":"stories")),s(),st(" ",t.newStoriesAvailable()," new ",t.newStoriesAvailable()===1?"story":"stories"," ")}}function ke(n,e){n&1&&T(0,"app-story-skeleton")}function Ce(n,e){if(n&1&&(c(0,"div",2),_t(1,ke,1,0,"app-story-skeleton",null,Lt),p()),n&2){let t=d();s(),xt(t.skeletonArray)}}function _e(n,e){if(n&1){let t=S();c(0,"div",3)(1,"p"),w(2),p(),c(3,"button",10),x("click",function(){m(t);let i=d();return u(i.refresh())}),w(4,"Try again"),p()()}if(n&2){let t=d();s(2),at(t.error())}}function xe(n,e){if(n&1&&T(0,"app-story-item",5),n&2){let t=e.$implicit,r=e.$index,i=d();_("story",t)("index",r+1)("ogData",i.getOpenGraphForStory(t))("isSelected",i.keyboardNavService.selectedIndex()===r),N("data-story-index",r)("data-story-id",t.id)}}function Se(n,e){if(n&1){let t=S();c(0,"div",6)(1,"button",11),x("click",function(){m(t);let i=d();return u(i.loadMore())}),w(2," Load More Stories "),p()()}}function Me(n,e){n&1&&(c(0,"div",7),T(1,"div",12),c(2,"span",13),w(3,"Loading more stories..."),p()())}function Oe(n,e){n&1&&(c(0,"div",8)(1,"p"),w(2,"No more stories to load"),p()())}var it=class n{storyType="top";pageSize=30;hnService=g(qt);ogService=g(K);stateService=g(Xt);sidebarService=g(ct);deviceService=g(Q);keyboardNavService=g(Zt);stories=C([]);loading=C(!0);error=C(null);currentPage=C(0);totalStoryIds=C([]);openGraphData=C(new Map);refreshing=C(!1);newStoriesAvailable=C(0);skeletonArray=Array(this.pageSize).fill(0).map((e,t)=>t);destroy$=new Ot;autoRefreshInterval=5*60*1e3;constructor(){Vt(()=>{let e=this.stories().length;this.keyboardNavService.setTotalItems(e)})}ngOnInit(){this.checkCacheForCurrentType(),this.startAutoRefresh()}ngOnChanges(e){e.storyType&&!e.storyType.firstChange&&(this.saveCurrentState(),this.checkCacheForCurrentType())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.saveCurrentState()}loadStories(e=!1,t){this.loading.set(!0),this.error.set(null),this.getStoryIds(e).pipe(I(r=>{this.totalStoryIds.set(r);let i=this.currentPage()*this.pageSize,o=i+this.pageSize,a=r.slice(i,o);return this.hnService.getItems(a)}),O(r=>r.filter(i=>i!==null)),kt(r=>{let i=r.filter(o=>o.url&&!this.isTextPost(o)).map(o=>o.url);i.length>0&&this.ogService.getOpenGraphDataBatch(i).subscribe({next:o=>{this.openGraphData.update(a=>{let l=new Map(a);return o.forEach((v,h)=>{l.set(h,v)}),l})},error:o=>{console.error("Error fetching OpenGraph data:",o)}})})).subscribe({next:r=>{if(this.stories.set(r),this.loading.set(!1),e&&t){let i=Date.now()-t,o=Math.max(0,500-i);o>0?setTimeout(()=>{this.refreshing.set(!1)},o):this.refreshing.set(!1);let a=this.totalStoryIds().slice(0,this.pageSize);this.refreshStoryDetails(a)}this.saveCurrentState()},error:r=>{this.error.set("Failed to load stories. Please try again."),this.loading.set(!1),e&&this.refreshing.set(!1),console.error("Error loading stories:",r)}})}getStoryIds(e=!1){switch(this.storyType){case"top":return this.hnService.getTopStories(e);case"best":return this.hnService.getBestStories(e);case"new":return this.hnService.getNewStories(e);case"ask":return this.hnService.getAskStories(e);case"show":return this.hnService.getShowStories(e);case"job":return this.hnService.getJobStories(e);default:return this.hnService.getTopStories(e)}}loadMore(){if(!this.hasMore())return;this.currentPage.update(i=>i+1),this.loading.set(!0);let e=this.currentPage()*this.pageSize,t=e+this.pageSize,r=this.totalStoryIds().slice(e,t);this.hnService.getItems(r).pipe(O(i=>i.filter(o=>o!==null)),kt(i=>{let o=i.filter(a=>a.url&&!this.isTextPost(a)).map(a=>a.url);o.length>0&&this.ogService.getOpenGraphDataBatch(o).subscribe({next:a=>{this.openGraphData.update(l=>{let v=new Map(l);return a.forEach((h,y)=>{v.set(y,h)}),v})},error:a=>{console.error("Error fetching OpenGraph data:",a)}})})).subscribe({next:i=>{this.stories.update(o=>[...o,...i]),this.loading.set(!1),this.saveCurrentState()},error:i=>{this.error.set("Failed to load more stories."),this.loading.set(!1),console.error("Error loading more stories:",i)}})}hasMore(){return(this.currentPage()+1)*this.pageSize<this.totalStoryIds().length}refresh(){this.refreshing.set(!0),this.stateService.clearState(this.storyType),this.currentPage.set(0),this.stories.set([]),this.openGraphData.set(new Map),this.keyboardNavService.clearSelection();let e=Date.now();this.loadStories(!0,e)}refreshStoryDetails(e){this.hnService.getItems(e,!0).subscribe({next:t=>{let r=t.filter(i=>i!==null);r.length>0&&(this.stories.set(r),this.saveCurrentState())},error:t=>{console.warn("Background refresh failed:",t)}})}startAutoRefresh(){Pt(this.autoRefreshInterval).pipe(Dt(this.destroy$),nt(()=>document.visibilityState==="visible"),nt(()=>!this.refreshing()),nt(()=>!this.isUserInteracting())).subscribe(()=>{this.silentRefreshStoryList()})}isUserInteracting(){return window.scrollY>200||this.keyboardNavService.selectedIndex()!==null}silentRefreshStoryList(){this.getStoryIds(!0).subscribe({next:e=>{let t=this.totalStoryIds(),r=this.countNewStoriesAtTop(t,e);r>0&&window.scrollY<100&&this.newStoriesAvailable.set(r),this.totalStoryIds.set(e);let i=this.stories().map(a=>a.id),o=e.slice(0,this.pageSize).filter(a=>!i.includes(a));o.length>0&&this.hnService.getItems(o).subscribe({next:a=>{this.mergeNewStories(a)},error:a=>{console.warn("Failed to fetch new stories:",a)}})},error:e=>{console.warn("Silent refresh failed:",e)}})}countNewStoriesAtTop(e,t){if(e.length===0)return 0;let r=e[0],i=t.indexOf(r);return i>0?i:0}mergeNewStories(e){let t=e.filter(a=>a!==null);if(t.length===0)return;let r=this.stories(),i=r.map(a=>a.id),o=t.filter(a=>!i.includes(a.id));if(o.length>0){let a=[...o,...r];this.stories.set(a.slice(0,this.pageSize)),this.saveCurrentState()}}loadNewStories(){this.newStoriesAvailable.set(0),this.refresh()}checkCacheForCurrentType(){let e=this.stateService.getState(this.storyType);e?(this.stories.set(e.stories),this.currentPage.set(e.currentPage),this.totalStoryIds.set(e.totalStoryIds),this.openGraphData.set(e.openGraphData),this.loading.set(!1),e.scrollPosition!==void 0&&setTimeout(()=>{window.scrollTo({top:e.scrollPosition,behavior:"instant"})},50)):this.loadStories()}saveCurrentState(){this.stateService.saveState(this.storyType,this.stories(),this.currentPage(),this.totalStoryIds(),this.openGraphData(),this.keyboardNavService.selectedIndex())}isTextPost(e){let t=e?.title||"";return!e?.url||t.startsWith("Ask HN:")||t.startsWith("Tell HN:")||t.startsWith("Show HN:")&&!e?.url}getOpenGraphForStory(e){return e.url?this.openGraphData().get(e.url):void 0}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["app-story-list"]],inputs:{storyType:"storyType",pageSize:"pageSize"},features:[It],decls:10,vars:8,consts:[[1,"transition-all","duration-300"],["role","button",1,"new-stories-indicator"],["role","status","aria-live","polite","aria-label","Loading Stories"],[1,"alert-error"],[1,"stories-space"],[3,"story","index","ogData","isSelected"],[1,"text-center","mt-8"],[1,"loading-wrap"],[1,"empty"],["role","button",1,"new-stories-indicator",3,"click"],[1,"alert-link",3,"click"],["aria-label","Load More Stories",1,"load-more-btn",3,"click"],[1,"loading-spin"],[1,"loading-text"]],template:function(t,r){t&1&&(c(0,"app-page-container",0),b(1,be,2,3,"button",1),b(2,Ce,3,0,"div",2),b(3,_e,5,1,"div",3),c(4,"div",4),_t(5,xe,1,6,"app-story-item",5,ye),p(),b(7,Se,3,0,"div",6),b(8,Me,4,0,"div",7),b(9,Oe,3,0,"div",8),p()),t&2&&(z("lg:w-[60vw]",r.sidebarService.isOpen()&&r.deviceService.isDesktop()),s(),k(r.newStoriesAvailable()>0&&!r.refreshing()?1:-1),s(),k(r.loading()&&r.stories().length===0||r.refreshing()?2:-1),s(),k(r.error()?3:-1),s(2),xt(r.stories()),s(2),k(r.hasMore()&&!r.loading()?7:-1),s(),k(r.loading()&&r.stories().length>0?8:-1),s(),k(!r.hasMore()&&r.stories().length>0?9:-1))},dependencies:[R,wt,ft,Qt],styles:[`@layer properties;.alert-error[_ngcontent-%COMP%]{margin-bottom:calc(var(--spacing, .25rem) * 4);border-radius:var(--radius-lg, .5rem);border-style:var(--tw-border-style);border-width:1px;border-color:var(--color-red-200, oklch(88.5% .062 18.334));background-color:var(--color-red-50, oklch(97.1% .013 17.38));padding-inline:calc(var(--spacing, .25rem) * 4);padding-block:calc(var(--spacing, .25rem) * 3);color:var(--color-red-700, oklch(50.5% .213 27.518))}.alert-error[_ngcontent-%COMP%]:where(.dark,.dark *){border-color:var(--color-red-800, oklch(44.4% .177 26.899))}.alert-error[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:color-mix(in srgb,oklch(39.6% .141 25.723) 30%,transparent)}@supports (color: color-mix(in lab,red,red)){.alert-error[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:color-mix(in oklab,var(--color-red-900, oklch(39.6% .141 25.723)) 30%,transparent)}}.alert-error[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-red-300, oklch(80.8% .114 19.571))}.alert-link[_ngcontent-%COMP%]{margin-top:calc(var(--spacing, .25rem) * 2);cursor:pointer;border-radius:.25rem;padding-inline:calc(var(--spacing, .25rem) * 1);font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)));text-decoration-line:underline}@media (hover: hover){.alert-link[_ngcontent-%COMP%]:hover{text-decoration-line:none}}.alert-link[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.alert-link[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.alert-link[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}:where(.stories-space[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child)){--tw-space-y-reverse: 0;margin-block-start:calc(calc(var(--spacing, .25rem) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing, .25rem) * 2) * calc(1 - var(--tw-space-y-reverse)))}@media (width >= 40rem){:where(.stories-space[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child)){--tw-space-y-reverse: 0;margin-block-start:calc(calc(var(--spacing, .25rem) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing, .25rem) * 3) * calc(1 - var(--tw-space-y-reverse)))}}.load-more-btn[_ngcontent-%COMP%]{cursor:pointer;border-radius:var(--radius-lg, .5rem);background-color:var(--color-blue-600, oklch(54.6% .245 262.881));padding-inline:calc(var(--spacing, .25rem) * 4);padding-block:calc(var(--spacing, .25rem) * 2);font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)));--tw-font-weight: var(--font-weight-medium, 500);font-weight:var(--font-weight-medium, 500);color:var(--color-white, #fff);transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s));--tw-duration: .2s;transition-duration:.2s}@media (hover: hover){.load-more-btn[_ngcontent-%COMP%]:hover{background-color:var(--color-blue-700, oklch(48.8% .243 264.376))}}.load-more-btn[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.load-more-btn[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.load-more-btn[_ngcontent-%COMP%]:focus-visible{--tw-ring-offset-width: 2px;--tw-ring-offset-shadow: var(--tw-ring-inset,) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color)}.load-more-btn[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}@media (width >= 40rem){.load-more-btn[_ngcontent-%COMP%]{padding-inline:calc(var(--spacing, .25rem) * 6)}}@media (width >= 40rem){.load-more-btn[_ngcontent-%COMP%]{padding-block:calc(var(--spacing, .25rem) * 3)}}@media (width >= 40rem){.load-more-btn[_ngcontent-%COMP%]{font-size:var(--text-base, 1rem);line-height:var(--tw-leading, var(--text-base--line-height, 1.5 ))}}.load-more-btn[_ngcontent-%COMP%]:where(.dark,.dark *):focus-visible{--tw-ring-offset-color: var(--color-gray-900, oklch(21% .034 264.665))}.loading-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding-block:calc(var(--spacing, .25rem) * 8)}.loading-spin[_ngcontent-%COMP%]{display:inline-block;height:calc(var(--spacing, .25rem) * 8);width:calc(var(--spacing, .25rem) * 8);animation:var(--animate-spin, _ngcontent-%COMP%_spin 1s linear infinite);border-radius:calc(infinity * 1px);border-bottom-style:var(--tw-border-style);border-bottom-width:2px;border-color:var(--color-blue-600, oklch(54.6% .245 262.881))}.loading-text[_ngcontent-%COMP%]{margin-left:calc(var(--spacing, .25rem) * 3);color:var(--color-gray-600, oklch(44.6% .03 256.802))}.loading-text[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.empty[_ngcontent-%COMP%]{padding-block:calc(var(--spacing, .25rem) * 8);text-align:center;color:var(--color-gray-500, oklch(55.1% .027 264.364))}.empty[_ngcontent-%COMP%]:where(.dark,.dark *){color:var(--color-gray-400, oklch(70.7% .022 261.325))}.new-stories-indicator[_ngcontent-%COMP%]{position:fixed;top:calc(var(--spacing, .25rem) * 20);left:50%;z-index:50;--tw-translate-x: -50% ;translate:var(--tw-translate-x) var(--tw-translate-y);animation:var(--animate-bounce, _ngcontent-%COMP%_bounce 1s infinite);cursor:pointer;border-radius:calc(infinity * 1px);background-color:var(--color-blue-600, oklch(54.6% .245 262.881));padding-inline:calc(var(--spacing, .25rem) * 4);padding-block:calc(var(--spacing, .25rem) * 2);font-size:var(--text-sm, .875rem);line-height:var(--tw-leading, var(--text-sm--line-height, calc(1.25 / .875)));--tw-font-weight: var(--font-weight-medium, 500);font-weight:var(--font-weight-medium, 500);color:var(--color-white, #fff);--tw-shadow: 0 10px 15px -3px var(--tw-shadow-color, rgb(0 0 0 / .1)), 0 4px 6px -4px var(--tw-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);transition-property:all;transition-timing-function:var(--tw-ease, var(--default-transition-timing-function, cubic-bezier(.4, 0, .2, 1)));transition-duration:var(--tw-duration, var(--default-transition-duration, .15s));--tw-duration: .2s;transition-duration:.2s}@media (hover: hover){.new-stories-indicator[_ngcontent-%COMP%]:hover{background-color:var(--color-blue-700, oklch(48.8% .243 264.376))}}.new-stories-indicator[_ngcontent-%COMP%]:focus-visible{--tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.new-stories-indicator[_ngcontent-%COMP%]:focus-visible{--tw-ring-color: var(--color-blue-500, oklch(62.3% .214 259.815))}.new-stories-indicator[_ngcontent-%COMP%]:focus-visible{--tw-ring-offset-width: 2px;--tw-ring-offset-shadow: var(--tw-ring-inset,) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color)}.new-stories-indicator[_ngcontent-%COMP%]:focus-visible{--tw-outline-style: none;outline-style:none}.new-stories-indicator[_ngcontent-%COMP%]:where(.dark,.dark *){background-color:var(--color-blue-500, oklch(62.3% .214 259.815))}.new-stories-indicator[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-shadow-color: color-mix(in srgb, oklch(27.8% .033 256.848) 50%, transparent)}@supports (color: color-mix(in lab,red,red)){.new-stories-indicator[_ngcontent-%COMP%]:where(.dark,.dark *){--tw-shadow-color: color-mix(in oklab, color-mix(in oklab, var(--color-gray-800, oklch(27.8% .033 256.848)) 50%, transparent) var(--tw-shadow-alpha), transparent)}}@media (hover: hover){.new-stories-indicator[_ngcontent-%COMP%]:where(.dark,.dark *):hover{background-color:var(--color-blue-600, oklch(54.6% .245 262.881))}}.new-stories-indicator[_ngcontent-%COMP%]:where(.dark,.dark *):focus-visible{--tw-ring-offset-color: var(--color-gray-900, oklch(21% .034 264.665))}@property --tw-border-style{syntax: "*"; inherits: false; initial-value: solid;}@property --tw-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-shadow-color{syntax: "*"; inherits: false;}@property --tw-shadow-alpha{syntax: "<percentage>"; inherits: false; initial-value: 100%;}@property --tw-inset-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-inset-shadow-color{syntax: "*"; inherits: false;}@property --tw-inset-shadow-alpha{syntax: "<percentage>"; inherits: false; initial-value: 100%;}@property --tw-ring-color{syntax: "*"; inherits: false;}@property --tw-ring-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-inset-ring-color{syntax: "*"; inherits: false;}@property --tw-inset-ring-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-ring-inset{syntax: "*"; inherits: false;}@property --tw-ring-offset-width{syntax: "<length>"; inherits: false; initial-value: 0px;}@property --tw-ring-offset-color{syntax: "*"; inherits: false; initial-value: #fff;}@property --tw-ring-offset-shadow{syntax: "*"; inherits: false; initial-value: 0 0 #0000;}@property --tw-space-y-reverse{syntax: "*"; inherits: false; initial-value: 0;}@property --tw-font-weight{syntax: "*"; inherits: false;}@property --tw-duration{syntax: "*"; inherits: false;}@property --tw-translate-x{syntax: "*"; inherits: false; initial-value: 0;}@property --tw-translate-y{syntax: "*"; inherits: false; initial-value: 0;}@property --tw-translate-z{syntax: "*"; inherits: false; initial-value: 0;}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}@layer properties{@supports ((-webkit-hyphens: none) and (not (margin-trim: inline))) or ((-moz-orient: inline) and (not (color:rgb(from red r g b)))){*[_ngcontent-%COMP%], [_ngcontent-%COMP%]:before, [_ngcontent-%COMP%]:after, [_ngcontent-%COMP%]::backdrop{--tw-border-style: solid;--tw-shadow: 0 0 #0000;--tw-shadow-color: initial;--tw-shadow-alpha: 100%;--tw-inset-shadow: 0 0 #0000;--tw-inset-shadow-color: initial;--tw-inset-shadow-alpha: 100%;--tw-ring-color: initial;--tw-ring-shadow: 0 0 #0000;--tw-inset-ring-color: initial;--tw-inset-ring-shadow: 0 0 #0000;--tw-ring-inset: initial;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-offset-shadow: 0 0 #0000;--tw-space-y-reverse: 0;--tw-font-weight: initial;--tw-duration: initial;--tw-translate-x: 0;--tw-translate-y: 0;--tw-translate-z: 0}}}

`]})};var Jt=class n{storyList;route=g(Rt);storyType="top";ngOnInit(){this.route.data.subscribe(e=>{let t=e.type||"top";this.storyType=t})}refresh(){this.storyList&&this.storyList.refresh()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["app-stories"]],viewQuery:function(t,r){if(t&1&&J(it,5),t&2){let i;tt(i=et())&&(r.storyList=i.first)}},decls:1,vars:1,consts:[[3,"storyType"]],template:function(t,r){t&1&&T(0,"app-story-list",0),t&2&&_("storyType",r.storyType)},dependencies:[R,it],encapsulation:2})};export{Jt as StoriesComponent};
