import{e as A,g as B,h as Q,k as V}from"./chunk-WSP23YN7.js";import{a as K}from"./chunk-VGHO6HNJ.js";import{a as $,b as U,e as z,g as q,h as O,i as G,j as Y}from"./chunk-NINWBLK3.js";import{a as J}from"./chunk-ALJNL3AC.js";import{$a as g,Aa as S,Ab as j,Ba as P,Bb as u,Db as f,Ea as s,Eb as C,F as H,Fb as y,I as k,Ib as T,Ma as D,_ as v,_b as W,ab as _,cb as I,da as L,db as F,ea as R,eb as h,fa as b,fb as n,ga as M,gb as r,hb as m,i as E,lb as N,na as p,nb as x,pb as d,zb as a}from"./chunk-A2HHJ6P6.js";var ee=i=>["/user",i],Z=i=>["/item",i],te=(i,o)=>o.objectID;function ne(i,o){i&1&&(n(0,"div",20)(1,"div",23),m(2,"div",24)(3,"div",25),r(),n(4,"div",23),m(5,"div",24)(6,"div",25),r(),n(7,"div",23),m(8,"div",24)(9,"div",25),r()())}function ie(i,o){if(i&1&&m(0,"a",35),i&2){let e=d(2).$implicit,t=d(2);h("href",e.url,P)("innerHTML",t.getHighlightedText(e,"title"),S)}}function re(i,o){if(i&1&&m(0,"a",36),i&2){let e=d(2).$implicit,t=d(2);h("routerLink",T(2,Z,e.objectID))("innerHTML",t.getHighlightedText(e,"title"),S)}}function oe(i,o){if(i&1&&m(0,"p",37),i&2){let e=d(2).$implicit,t=d(2);h("innerHTML",t.getHighlightedText(e,"story_text"),S)}}function ae(i,o){if(i&1&&(n(0,"h3",34),g(1,ie,1,2,"a",35)(2,re,1,4,"a",36),r(),g(3,oe,1,1,"p",37)),i&2){let e=d().$implicit;s(),_(e.url?1:2),s(2),_(e.story_text?3:-1)}}function le(i,o){if(i&1&&m(0,"div",31),i&2){let e=d().$implicit,t=d(2);h("innerHTML",t.getHighlightedText(e,"comment_text"),S)}}function se(i,o){if(i&1&&(n(0,"div",29),g(1,ae,4,2)(2,le,1,1,"div",31),n(3,"div",32)(4,"span"),a(5),r(),n(6,"span"),a(7,"\u2022"),r(),n(8,"span"),a(9,"by "),n(10,"a",33),a(11),r()(),n(12,"span"),a(13,"\u2022"),r(),n(14,"span"),a(15),r(),n(16,"span"),a(17,"\u2022"),r(),n(18,"a",33),a(19),r()()()),i&2){let e=o.$implicit,t=d(2);s(),_(e.title?1:e.comment_text?2:-1),s(4),u("",e.points||0," points"),s(5),h("routerLink",T(7,ee,e.author)),s(),u(" ",e.author," "),s(4),j(t.getTimeAgo(e.created_at)),s(3),h("routerLink",T(9,Z,e.objectID)),s(),u(" ",e.num_comments||0," comments ")}}function ce(i,o){if(i&1){let e=N();n(0,"div",30)(1,"button",38),x("click",function(){L(e);let c=d(2);return R(c.loadMore())}),a(2),r()()}if(i&2){let e=d(2);s(),h("disabled",e.loadingMore()),s(),u(" ",e.loadingMore()?"Loading...":"Load More"," ")}}function de(i,o){if(i&1&&(n(0,"div",21)(1,"div",26)(2,"p",27),a(3),n(4,"strong"),a(5),r()()(),n(6,"div",28),I(7,se,20,11,"div",29,te),r(),g(9,ce,3,2,"div",30),r()),i&2){let e=d();s(3),u(" Found ",e.totalResults()," results for "),s(2),u('"',e.searchQuery,'"'),s(2),F(e.results()),s(2),_(e.hasMore()?9:-1)}}function me(i,o){if(i&1&&(n(0,"div",22),b(),n(1,"svg",39),m(2,"path",40),r(),M(),n(3,"p",41),a(4),r(),n(5,"p",42),a(6,"Try adjusting your search terms or filters"),r()()),i&2){let e=d();s(4),u('No results found for "',e.searchQuery,'"')}}function he(i,o){i&1&&(n(0,"div",22),b(),n(1,"svg",39),m(2,"path",6),r(),M(),n(3,"p",41),a(4,"Enter a search term to get started"),r(),n(5,"p",42),a(6," Search across all Hacker News stories and comments "),r()())}var X=class i{route=v(A);router=v(B);hnService=v(V);searchQuery="";searchType="story";sortBy="relevance";dateRange="all";results=p([]);totalResults=p(0);loading=p(!1);loadingMore=p(!1);currentPage=p(0);searchSubject=new E;ngOnInit(){this.searchSubject.pipe(H(300),k()).subscribe(()=>{this.performSearch()}),this.route.queryParams.subscribe(o=>{o.q&&(this.searchQuery=o.q,this.performSearch())})}onSearchChange(o){this.searchSubject.next(o),this.router.navigate([],{relativeTo:this.route,queryParams:{q:o},queryParamsHandling:"merge"})}performSearch(){if(!this.searchQuery.trim()){this.results.set([]),this.totalResults.set(0);return}this.loading.set(!0),this.currentPage.set(0);let o=this.buildSearchUrl();this.hnService.searchStories(o).subscribe({next:e=>{let t=Array.isArray(e.hits)?e.hits:[];this.results.set(t),this.totalResults.set(e.nbHits||0),this.loading.set(!1)},error:()=>{this.loading.set(!1)}})}loadMore(){this.loadingMore.set(!0),this.currentPage.update(e=>e+1);let o=this.buildSearchUrl();this.hnService.searchStories(o).subscribe({next:e=>{let t=Array.isArray(e.hits)?e.hits:[];this.results.update(c=>[...c,...t]),this.loadingMore.set(!1)},error:()=>{this.loadingMore.set(!1)}})}buildSearchUrl(){let o=this.searchQuery;if(this.searchType!=="all"&&(o+=`&tags=${this.searchType}`),this.dateRange!=="all"){let e=Math.floor(Date.now()/1e3),t=e;switch(this.dateRange){case"24h":t=e-86400;break;case"week":t=e-604800;break;case"month":t=e-2592e3;break;case"year":t=e-31536e3;break}o+=`&numericFilters=created_at_i>${t}`}return this.sortBy==="date"&&(o=o.replace("search?","search_by_date?")),o+=`&page=${this.currentPage()}`,o}hasMore(){return this.results().length<this.totalResults()}getHighlightedText(o,e){let t=o._highlightResult?.[e]?.value;return typeof t=="string"?t:o[e]||""}getTimeAgo(o){let e=new Date(o),t=Math.floor((Date.now()-e.getTime())/1e3),c=Math.floor(t/60),l=Math.floor(c/60),w=Math.floor(l/24);return w>0?`${w} day${w>1?"s":""} ago`:l>0?`${l} hour${l>1?"s":""} ago`:c>0?`${c} minute${c>1?"s":""} ago`:"just now"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-search"]],decls:40,vars:5,consts:[["variant","narrow"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[1,"relative"],["type","text","placeholder","Search stories, comments, users...",1,"w-full","px-4","py-3","pr-12","rounded-lg","border","border-gray-300","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","text-lg",3,"ngModelChange","ngModel"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"absolute","right-4","top-3.5","w-6","h-6","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-4","mt-4"],[1,"px-3","py-2","rounded","border","border-gray-300","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["value","story"],["value","comment"],["value","all"],["value","relevance"],["value","date"],["value","points"],["value","comments"],["value","24h"],["value","week"],["value","month"],["value","year"],[1,"animate-pulse","space-y-4"],[1,"bg-white","rounded-lg","shadow-sm"],[1,"bg-white","rounded-lg","shadow-sm","p-8","text-center"],[1,"bg-white","rounded-lg","shadow-sm","p-4"],[1,"h-4","bg-gray-200","rounded","w-3/4","mb-2"],[1,"h-3","bg-gray-200","rounded","w-1/2"],[1,"p-4","border-b","border-gray-200"],[1,"text-sm","text-gray-600"],[1,"divide-y","divide-gray-200"],[1,"p-4","hover:bg-gray-50"],[1,"p-4","border-t","border-gray-200"],[1,"prose","prose-sm","max-w-none","text-gray-800","mb-2","line-clamp-3",3,"innerHTML"],[1,"flex","items-center","gap-3","text-sm","text-gray-500"],[1,"text-blue-600","hover:underline",3,"routerLink"],[1,"font-medium","text-gray-900","mb-1"],["target","_blank","rel","noopener noreferrer",1,"hover:text-blue-600",3,"href","innerHTML"],[1,"hover:text-blue-600",3,"routerLink","innerHTML"],[1,"text-sm","text-gray-600","mb-2","line-clamp-2",3,"innerHTML"],[1,"w-full","py-2","px-4","bg-blue-600","text-white","rounded","hover:bg-blue-700","disabled:opacity-50",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","text-gray-400","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01"],[1,"text-gray-600"],[1,"text-sm","text-gray-500","mt-2"]],template:function(e,t){e&1&&(n(0,"app-page-container",0)(1,"app-card",1)(2,"h1",2),a(3,"Search Hacker News"),r(),n(4,"div",3)(5,"input",4),y("ngModelChange",function(l){return C(t.searchQuery,l)||(t.searchQuery=l),l}),x("ngModelChange",function(l){return t.onSearchChange(l)}),r(),b(),n(6,"svg",5),m(7,"path",6),r()(),M(),n(8,"div",7)(9,"select",8),y("ngModelChange",function(l){return C(t.searchType,l)||(t.searchType=l),l}),x("ngModelChange",function(){return t.performSearch()}),n(10,"option",9),a(11,"Stories"),r(),n(12,"option",10),a(13,"Comments"),r(),n(14,"option",11),a(15,"All"),r()(),n(16,"select",8),y("ngModelChange",function(l){return C(t.sortBy,l)||(t.sortBy=l),l}),x("ngModelChange",function(){return t.performSearch()}),n(17,"option",12),a(18,"Relevance"),r(),n(19,"option",13),a(20,"Date"),r(),n(21,"option",14),a(22,"Points"),r(),n(23,"option",15),a(24,"Comments"),r()(),n(25,"select",8),y("ngModelChange",function(l){return C(t.dateRange,l)||(t.dateRange=l),l}),x("ngModelChange",function(){return t.performSearch()}),n(26,"option",11),a(27,"All Time"),r(),n(28,"option",16),a(29,"Last 24 Hours"),r(),n(30,"option",17),a(31,"Past Week"),r(),n(32,"option",18),a(33,"Past Month"),r(),n(34,"option",19),a(35,"Past Year"),r()()()(),g(36,ne,10,0,"div",20)(37,de,10,3,"div",21)(38,me,7,1,"div",22)(39,he,7,0,"div",22),r()),e&2&&(s(5),f("ngModel",t.searchQuery),s(4),f("ngModel",t.searchType),s(7),f("ngModel",t.sortBy),s(9),f("ngModel",t.dateRange),s(11),_(t.loading()?36:t.results().length>0?37:t.searchQuery&&!t.loading()?38:39))},dependencies:[W,Y,O,G,$,q,U,z,Q,J,K],encapsulation:2})};export{X as SearchComponent};
