import{a as z}from"./chunk-S5G73RLP.js";import{l as D}from"./chunk-SRDQ2QLC.js";import{$a as r,Aa as M,Ab as S,Bb as y,Ea as s,Ma as R,Mb as v,Yb as E,_ as w,_a as T,_b as N,ab as m,cb as V,da as g,db as I,ea as h,eb as c,fa as x,fb as n,ga as L,gb as o,hb as u,lb as f,na as p,nb as b,pb as a,xb as k,zb as _}from"./chunk-A2HHJ6P6.js";var H=(t,i)=>i.id;function $(t,i){t&1&&(n(0,"span",4),x(),n(1,"svg",5),u(2,"circle",6)(3,"path",7),o(),_(4," Loading comment... "),o())}function A(t,i){t&1&&_(0," Load comment ")}function B(t,i){if(t&1){let e=f();n(0,"div",0)(1,"button",3),b("click",function(){g(e);let d=a();return h(d.loadComment())}),r(2,$,5,0,"span",4)(3,A,1,0),o()()}if(t&2){let e=a();c("ngClass",e.depth>0?"ml-2 sm:ml-4":""),s(),c("disabled",e.loading()),s(),m(e.loading()?2:3)}}function F(t,i){if(t&1&&(n(0,"div",1),u(1,"div",8)(2,"div",9),o()),t&2){let e=a();c("ngClass",e.depth>0?"ml-4 border-l-2 border-gray-200 pl-4":"")}}function G(t,i){if(t&1&&u(0,"app-user-tag",14),t&2){let e=a(2);c("username",e.comment().by)}}function K(t,i){if(t&1){let e=f();n(0,"button",19),b("click",function(){g(e);let d=a(2);return h(d.toggleCollapse())}),n(1,"span",20),_(2),o()()}if(t&2){let e=a(2);T("aria-label",e.isCollapsed()?"Expand thread":"Collapse thread")("aria-expanded",!e.isCollapsed()),s(2),y(" [",e.isCollapsed()?"+":"\u2212","] ")}}function O(t,i){t&1&&(n(0,"span",22),x(),n(1,"svg",23),u(2,"circle",6)(3,"path",7),o(),_(4," Loading... "),o())}function j(t,i){if(t&1&&_(0),t&2){let e=a(3);y(" [+",e.totalRepliesCount()," replies] ")}}function J(t,i){if(t&1){let e=f();n(0,"button",21),b("click",function(){g(e);let d=a(2);return h(d.expandReplies())}),r(1,O,5,0,"span",22)(2,j,1,1),o()}if(t&2){let e=a(2);c("disabled",e.loadingReplies()),T("aria-label","Expand "+e.totalRepliesCount()+" replies"),s(),m(e.loadingReplies()?1:2)}}function U(t,i){t&1&&(n(0,"div",26)(1,"div",28),x(),n(2,"svg",5),u(3,"circle",6)(4,"path",7),o(),_(5," Loading replies... "),o()())}function q(t,i){if(t&1&&u(0,"app-comment-thread",29),t&2){let e=a().$implicit,l=a(4);c("commentId",e.id)("depth",l.depth+1)("lazyLoad",!0)}}function Q(t,i){if(t&1&&u(0,"app-user-tag",14),t&2){let e=a(2).$implicit;c("username",e.by)}}function W(t,i){if(t&1&&(n(0,"div",30)(1,"div",10),r(2,Q,1,1,"app-user-tag",14),n(3,"span",15),_(4),o()(),u(5,"div",31),o()),t&2){let e=a().$implicit,l=a(4);s(2),m(e.by?2:-1),s(2),S(l.getTimeAgo(e.time)),s(),c("innerHTML",e.text,M)}}function X(t,i){if(t&1&&r(0,q,1,3,"app-comment-thread",29)(1,W,6,3,"div",30),t&2){let e=i.$implicit;m(e.kids&&e.kids.length>0?0:1)}}function Y(t,i){t&1&&(n(0,"span",22),x(),n(1,"svg",23),u(2,"circle",6)(3,"path",7),o(),_(4," Loading... "),o())}function Z(t,i){if(t&1&&_(0),t&2){let e=a(5);y(" Load ",e.remainingRepliesCount," more replies ")}}function ee(t,i){if(t&1){let e=f();n(0,"div",27)(1,"button",32),b("click",function(){g(e);let d=a(4);return h(d.loadMoreReplies())}),r(2,Y,5,0,"span",22)(3,Z,1,1),o()()}if(t&2){let e=a(4);s(),c("disabled",e.loadingMore()),s(),m(e.loadingMore()?2:3)}}function te(t,i){if(t&1&&(n(0,"div",25),r(1,U,6,0,"div",26),V(2,X,2,1,null,null,H),r(4,ee,4,2,"div",27),o()),t&2){let e=a(3);s(),m(e.loadingReplies()&&e.replies().length===0?1:-1),s(),I(e.replies()),s(2),m(e.hasMoreReplies()?4:-1)}}function ie(t,i){if(t&1&&(u(0,"div",24),r(1,te,5,2,"div",25)),t&2){let e=a(2);c("innerHTML",e.comment().text,M),s(),m(e.replies().length>0||e.loadingReplies()?1:-1)}}function ne(t,i){t&1&&(n(0,"span",18),_(1,"[collapsed]"),o())}function oe(t,i){if(t&1){let e=f();n(0,"div",2)(1,"div",10)(2,"button",11),b("click",function(){g(e);let d=a();return h(d.upvoteComment())}),x(),n(3,"svg",12),u(4,"path",13),o()(),r(5,G,1,1,"app-user-tag",14),L(),n(6,"span",15),_(7),o(),r(8,K,3,3,"button",16),r(9,J,3,3,"button",17),o(),r(10,ie,2,2)(11,ne,2,0,"span",18),o()}if(t&2){let e=a();c("ngClass",e.depth>0?"ml-2 sm:ml-4 border-l-2 border-gray-200 pl-2 sm:pl-4":""),s(2),k("text-blue-600",!e.hasVoted())("text-gray-400",e.hasVoted())("opacity-50",e.hasVoted()),c("disabled",e.hasVoted()),T("aria-label",e.hasVoted()?"Already upvoted comment":"Upvote comment")("aria-pressed",e.hasVoted()),s(3),m(e.comment().by?5:-1),s(2),S(e.getTimeAgo(e.comment().time)),s(),m(e.replies().length>0?8:-1),s(),m(e.showExpandButton()?9:-1),s(),m(e.isCollapsed()?11:10)}}var P=class t{commentId;depth=0;lazyLoad=!1;autoCollapseThreshold=10;hnService=w(D);comment=p(null);replies=p([]);isCollapsed=p(!1);loading=p(!0);votedComments=p(new Set);repliesLoaded=p(!1);loadingReplies=p(!1);commentLoaded=p(!1);currentPage=p(0);pageSize=10;hasMoreReplies=p(!1);loadingMore=p(!1);allKidsIds=[];constructor(){let i=localStorage.getItem("votedComments");i&&this.votedComments.set(new Set(JSON.parse(i)))}hasVoted=v(()=>this.votedComments().has(this.comment()?.id||0));shouldAutoCollapse=v(()=>{let i=this.comment();return i?.kids&&i.kids.length>=this.autoCollapseThreshold});totalRepliesCount=v(()=>this.comment()?.kids?.length||0);showExpandButton=v(()=>this.totalRepliesCount()>0&&!this.repliesLoaded());showLoadButton=v(()=>this.lazyLoad&&!this.commentLoaded());get currentPageValue(){return this.currentPage()}get remainingRepliesCount(){let i=this.allKidsIds.length-(this.currentPage()+1)*this.pageSize;return Math.min(this.pageSize,i)}ngOnInit(){this.lazyLoad?this.loading.set(!1):this.loadComment()}loadComment(){this.loading.set(!0),this.hnService.getItem(this.commentId).subscribe({next:i=>{i&&!i.deleted?(this.comment.set(i),this.commentLoaded.set(!0),i.kids&&i.kids.length>0?(this.allKidsIds=i.kids,this.hasMoreReplies.set(i.kids.length>this.pageSize),this.loading.set(!1),this.shouldAutoCollapse()||setTimeout(()=>this.loadRepliesPage(0),50)):this.loading.set(!1)):this.loading.set(!1)},error:()=>{this.loading.set(!1)}})}loadRepliesPage(i){i===0?this.loadingReplies.set(!0):this.loadingMore.set(!0),this.hnService.getItemsPage(this.allKidsIds,i,this.pageSize).subscribe({next:e=>{let l=e.filter(C=>C!==null&&!C.deleted);i===0?(this.replies.set(l),this.repliesLoaded.set(!0)):this.replies.update(C=>[...C,...l]),this.currentPage.set(i);let d=(i+1)*this.pageSize;this.hasMoreReplies.set(d<this.allKidsIds.length),this.loadingReplies.set(!1),this.loadingMore.set(!1)},error:()=>{this.loadingReplies.set(!1),this.loadingMore.set(!1)}})}loadMoreReplies(){if(!this.loadingMore()&&this.hasMoreReplies()){let i=this.currentPage()+1;this.loadRepliesPage(i)}}expandReplies(){!this.repliesLoaded()&&!this.loadingReplies()&&this.loadRepliesPage(0)}toggleCollapse(){this.isCollapsed.update(i=>!i)}upvoteComment(){if(this.hasVoted()||!this.comment())return;let i=new Set(this.votedComments());i.add(this.comment().id),this.votedComments.set(i),localStorage.setItem("votedComments",JSON.stringify(Array.from(i)))}getTimeAgo(i){let e=Math.floor(Date.now()/1e3-i),l=Math.floor(e/60),d=Math.floor(l/60),C=Math.floor(d/24);return C>0?`${C} day${C>1?"s":""} ago`:d>0?`${d} hour${d>1?"s":""} ago`:l>0?`${l} minute${l>1?"s":""} ago`:"just now"}getIndentClass(){return`ml-${Math.min(this.depth,8)*4}`}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=R({type:t,selectors:[["app-comment-thread"]],inputs:{commentId:"commentId",depth:"depth",lazyLoad:"lazyLoad"},decls:3,vars:1,consts:[[1,"mb-4","p-3","bg-gray-50","border","border-gray-200","rounded-lg",3,"ngClass"],[1,"animate-pulse","mb-4",3,"ngClass"],[1,"mb-4",3,"ngClass"],[1,"text-blue-600","hover:text-blue-800","text-sm","font-medium","disabled:opacity-50","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","disabled"],[1,"flex","items-center","gap-2"],["fill","none","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"h-4","bg-gray-200","rounded","w-1/4","mb-2"],[1,"h-3","bg-gray-200","rounded","w-3/4"],[1,"flex","items-center","gap-2","text-xs","sm:text-sm","text-gray-600","mb-1"],[1,"hover:scale-110","transition-transform","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","disabled"],["fill","currentColor","viewBox","0 0 20 20","aria-hidden","true",1,"w-3","h-3","sm:w-4","sm:h-4"],["d","M10 3L3 10h4v7h6v-7h4L10 3z"],[3,"username"],[1,"text-gray-500"],[1,"text-gray-400","hover:text-gray-600","ml-2","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1"],[1,"text-blue-600","hover:text-blue-800","ml-2","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1","text-xs","disabled:opacity-50",3,"disabled"],[1,"text-sm","text-gray-500","italic"],[1,"text-gray-400","hover:text-gray-600","ml-2","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1",3,"click"],[1,"text-xs"],[1,"text-blue-600","hover:text-blue-800","ml-2","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1","text-xs","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","gap-1"],["fill","none","viewBox","0 0 24 24",1,"w-3","h-3","animate-spin"],[1,"prose","prose-xs","sm:prose-sm","max-w-none","text-gray-800","mb-2","text-sm","sm:text-base",3,"innerHTML"],[1,"mt-2"],[1,"ml-2","sm:ml-4","py-2"],[1,"mt-3","ml-2","sm:ml-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-500"],[3,"commentId","depth","lazyLoad"],[1,"mb-3","ml-2","sm:ml-4","border-l-2","border-gray-200","pl-2","sm:pl-4"],[1,"prose","prose-xs","sm:prose-sm","max-w-none","text-gray-800","text-sm","sm:text-base",3,"innerHTML"],[1,"px-3","py-1","text-xs","sm:text-sm","bg-blue-50","text-blue-600","rounded-md","hover:bg-blue-100","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500",3,"click","disabled"]],template:function(e,l){e&1&&r(0,B,4,3,"div",0)(1,F,3,1,"div",1)(2,oe,12,15,"div",2),e&2&&m(l.showLoadButton()?0:l.loading()?1:l.comment()?2:-1)},dependencies:[t,N,E,z],encapsulation:2})};export{P as a};
