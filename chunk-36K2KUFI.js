import{a as X,b as Y}from"./chunk-IYGG5TYU.js";import{a as De,b as Ie}from"./chunk-77LKTX5Y.js";import{b as Se,e as _e,g as we,h as xe,k as ke}from"./chunk-WSP23YN7.js";import"./chunk-SXXLH57T.js";import"./chunk-NINWBLK3.js";import{a as Te}from"./chunk-ALJNL3AC.js";import{$a as g,A as W,Ab as Q,Ba as A,Bb as M,Cb as fe,D as ae,Ea as s,Hb as ve,Ib as ye,Ma as I,Mb as K,P as G,R as le,Sa as he,V as Z,Wb as be,_ as p,_a as F,_b as E,ab as f,bb as ge,c as P,cb as me,cc as Ce,da as u,db as de,ea as h,eb as v,fa as U,fb as a,ga as ce,gb as l,hb as _,ib as S,jb as T,kb as L,l as R,lb as x,m as V,mb as $,na as w,nb as y,ob as z,pb as c,q as pe,r as se,s as O,xb as N,z as ue,zb as d}from"./chunk-A2HHJ6P6.js";var J=class n{queues=new Map;limits={hackernews:{maxRequests:30,windowMs:6e4},algolia:{maxRequests:100,windowMs:6e4},microlink:{maxRequests:10,windowMs:6e4}};throttle(t,i){return P(this,null,function*(){let e=this.limits[t]||{maxRequests:10,windowMs:6e4};this.queues.has(t)||this.queues.set(t,{timestamps:[],pending:[]});let r=this.queues.get(t),o=Date.now();if(r.timestamps=r.timestamps.filter(k=>o-k<e.windowMs),r.timestamps.length<e.maxRequests)return r.timestamps.push(o),i();let C=r.timestamps[0]+e.windowMs-o;return new Promise((k,b)=>{setTimeout(()=>P(this,null,function*(){try{let D=yield this.throttle(t,i);k(D)}catch(D){b(D)}}),C)})})}isNearLimit(t){let i=this.limits[t];if(!i)return!1;let e=this.queues.get(t);if(!e)return!1;let r=Date.now();return e.timestamps.filter(m=>r-m<i.windowMs).length>=i.maxRequests*.8}getUsageStats(t){let i=this.limits[t];if(!i)return{current:0,max:0,resetIn:0};let e=this.queues.get(t);if(!e||e.timestamps.length===0)return{current:0,max:i.maxRequests,resetIn:0};let r=Date.now(),o=e.timestamps.filter(k=>r-k<i.windowMs),m=o[0]||r,C=Math.max(0,m+i.windowMs-r);return{current:o.length,max:i.maxRequests,resetIn:C}}throttleBatch(t,i){return P(this,null,function*(){let e=[];for(let r of i){let o=yield this.throttle(t,r);e.push(o)}return e})}getAvailableCapacity(t){let i=this.limits[t];if(!i)return 0;let e=this.queues.get(t);if(!e)return i.maxRequests;let r=Date.now(),o=e.timestamps.filter(m=>r-m<i.windowMs);return Math.max(0,i.maxRequests-o.length)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};var j=class n{http=p(Se);cache=p(Ce);rateLimiter=p(J);API_URL="https://api.microlink.io";failedUrls=new Set;MAX_RETRIES=3;retryCount=new Map;FALLBACK_ICON="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSI+CiAgPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iOCIgZmlsbD0iI0U1RTdFQiIvPgogIDxwYXRoIGQ9Ik0yOCAyMGg4bC00IDEyaDRsLTggMTIgMi0xMGgtNGwyLTE0eiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K";getOpenGraphData(t){return t?this.failedUrls.has(t)?V(this.getDefaultData(t)):R(this.cache.get("opengraph",t)).pipe(G(i=>{if(i)return V(i);let e=this.retryCount.get(t)||0;return e>=this.MAX_RETRIES?(this.failedUrls.add(t),V(this.getDefaultData(t))):(this.retryCount.set(t,e+1),this.fetchFromMicrolink(t).pipe(se(1e4),G(r=>(this.retryCount.delete(t),R(this.cache.set("opengraph",t,r)).pipe(O(()=>r)))),ae(r=>{console.warn(`OpenGraph fetch failed for ${t} (attempt ${e+1}):`,r),e+1>=this.MAX_RETRIES&&this.failedUrls.add(t);let o=this.getDefaultData(t);return R(this.cache.set("opengraph",t,o)).pipe(O(()=>o))})))})):V(this.getDefaultData(t))}fetchFromMicrolink(t){let i=`${this.API_URL}/?url=${encodeURIComponent(t)}`;return R(this.rateLimiter.throttle("microlink",()=>pe(this.http.get(i)))).pipe(O(e=>{if(e.status==="success"&&e.data){let r=e.data;return{title:r.title||"",description:r.description||"",image:r.image?.url||r.screenshot?.url||"",siteName:r.publisher||"",favicon:r.logo?.url||this.getSafeFaviconUrl(t)||this.FALLBACK_ICON,url:r.url||t}}return this.getDefaultData(t)}))}getDefaultData(t){return{title:"",description:"",image:"",siteName:this.getDomain(t),favicon:this.getSafeFaviconUrl(t)||this.FALLBACK_ICON,url:t}}getDomain(t){if(!t)return"";try{return new URL(t).hostname.replace("www.","")}catch{return""}}getSafeFaviconUrl(t){if(!t)return this.FALLBACK_ICON;let i=this.getDomain(t);return i?this.failedUrls.has(t)?this.FALLBACK_ICON:i.includes("localhost")||i.includes("127.0.0.1")||i.includes("0.0.0.0")||i.length<3?this.FALLBACK_ICON:`https://www.google.com/s2/favicons?domain=${i}&sz=64`:this.FALLBACK_ICON}getOpenGraphDataBatch(t){if(!t||t.length===0)return V(new Map);let i=[...new Set(t.filter(e=>e&&e.length>0))];return R(Promise.all(i.map(e=>this.cache.get("opengraph",e).then(r=>({url:e,cached:r}))))).pipe(G(e=>{let r=new Map,o=[];if(e.forEach(({url:b,cached:D})=>{D?r.set(b,D):o.push(b)}),o.length===0)return V(r);let m=8,C=[];for(let b=0;b<o.length;b+=m)C.push(o.slice(b,b+m));let k=C.map(b=>{let D=b.map((H,Ee)=>{let Ve=Ee*200;return ue(Ve).pipe(G(()=>this.getOpenGraphData(H).pipe(se(12e3),O(oe=>{let B=new Map;return B.set(H,oe),B}),ae(oe=>{console.warn(`Individual request failed for ${H}:`,oe);let B=new Map;return B.set(H,this.getDefaultData(H)),V(B)}))))});return W(...D)});return W(V(r),W(...k))}))}getOpenGraphDataViaProxy(t){return this.getOpenGraphData(t)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};function Le(n,t){n&1&&(S(0,"div",1),U(),S(1,"svg",5),L(2,"path",6),T()())}function Oe(n,t){n&1&&L(0,"div",2)}function Ne(n,t){if(n&1){let i=x();S(0,"a",7),z("click",function(){u(i);let r=c();return h(r.handleLinkClick())}),S(1,"img",8),z("error",function(r){u(i);let o=c();return h(o.handleImageError(r))}),T()()}if(n&2){let i=c();$("href",i.storyUrl,A),s(),$("src",i.ogData.image,A)("alt","Thumbnail for "+i.storyTitle)}}function Pe(n,t){if(n&1){let i=x();S(0,"a",9),z("click",function(){u(i);let r=c();return h(r.handleLinkClick())}),S(1,"img",10),z("error",function(r){u(i);let o=c();return h(o.handleImageError(r))}),T()()}if(n&2){let i=c();$("href",i.storyUrl,A),s(),$("src",(i.ogData==null?null:i.ogData.favicon)||"/assets/default-thumb.svg",A)("alt","Favicon for "+i.storyTitle)}}var ee=class n{storyUrl;storyTitle="";ogData;loading=!1;isTextPost=!1;linkClicked=new he;handleLinkClick(){this.linkClicked.emit()}handleImageError(t){let i=t.target;i.src="/assets/default-thumb.svg"}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=I({type:n,selectors:[["app-story-thumbnail"]],inputs:{storyUrl:"storyUrl",storyTitle:"storyTitle",ogData:"ogData",loading:"loading",isTextPost:"isTextPost"},outputs:{linkClicked:"linkClicked"},decls:5,vars:1,consts:[[1,"w-20","h-20","relative","overflow-hidden"],[1,"w-full","h-full","bg-gray-100","flex","items-center","justify-center"],[1,"w-full","h-full","bg-gray-200","animate-pulse"],["target","_blank","rel","noopener noreferrer nofollow",1,"block","w-full","h-full","hover:opacity-90","transition-opacity",3,"href"],["target","_blank","rel","noopener noreferrer nofollow",1,"block","w-full","h-full","bg-gray-100","hover:opacity-90","transition-opacity",3,"href"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"],["target","_blank","rel","noopener noreferrer nofollow",1,"block","w-full","h-full","hover:opacity-90","transition-opacity",3,"click","href"],["loading","lazy",1,"w-full","h-full","object-cover",3,"error","src","alt"],["target","_blank","rel","noopener noreferrer nofollow",1,"block","w-full","h-full","bg-gray-100","hover:opacity-90","transition-opacity",3,"click","href"],["loading","lazy",1,"w-full","h-full","object-contain","p-2",3,"error","src","alt"]],template:function(i,e){i&1&&(S(0,"div",0),g(1,Le,3,0,"div",1)(2,Oe,1,0,"div",2)(3,Ne,2,3,"a",3)(4,Pe,2,3,"a",4),T()),i&2&&(s(),f(e.isTextPost?1:e.loading?2:e.ogData!=null&&e.ogData.image?3:4))},dependencies:[E],encapsulation:2})};var Ge=n=>["/item",n];function Ae(n,t){n&1&&_(0,"div",1),n&2&&v("title","You have visited this story")}function Re(n,t){if(n&1){let i=x();a(0,"a",31),y("click",function(){u(i);let r=c();return h(r.markAsVisited())}),d(1),l()}if(n&2){let i=c();v("href",i.story.url,A),s(),M(" ",i.story.title," ")}}function Ue(n,t){if(n&1){let i=x();a(0,"a",32),y("click",function(){u(i);let r=c();return h(r.markAsVisited())}),d(1),l()}if(n&2){let i=c();v("routerLink",ye(2,Ge,i.story.id)),s(),M(" ",i.story.title," ")}}function Fe(n,t){if(n&1){let i=x();a(0,"button",33),y("click",function(r){u(i);let o=c();return h(o.searchByDomain(r))})("keyup.enter",function(r){u(i);let o=c();return h(o.searchByDomain(r))})("keyup.space",function(r){u(i);let o=c();return h(o.searchByDomain(r))}),d(1),l()}if(n&2){let i,e=c();v("title","Search for more stories from "+e.getDomain(e.story.url)),F("aria-label","Search for more stories from "+e.getDomain(e.story.url)),s(),M(" (",((i=e.ogDataSignal())==null?null:i.siteName)||e.getDomain(e.story.url),") ")}}function qe(n,t){if(n&1&&(a(0,"p",21),d(1),l()),n&2){let i=c();s(),M(" ",i.ogDataSignal().description," ")}}function je(n,t){if(n&1&&(a(0,"span"),d(1,"by "),_(2,"app-user-tag",34),l()),n&2){let i=c();s(2),v("username",i.story.by)}}function He(n,t){if(n&1&&(a(0,"span",25),d(1),l()),n&2){let i=c();s(),M("[+",i.getNewCommentCount(),"]")}}function Be(n,t){if(n&1){let i=x();a(0,"div",30)(1,"button",35),y("click",function(){u(i);let r=c();return h(r.shareStory())}),d(2),l(),a(3,"button",36),y("click",function(){u(i);let r=c();return h(r.shareComments())}),d(4),l()()}if(n&2){let i=c();s(2),M(" ",i.getStoryShareText()," "),s(2),M(" ",i.getCommentsShareText()," ")}}var ie=class n{story;index=0;ogData;votedItems=w(new Set);ogService=p(j);router=p(we);visitedService=p(Ie);sidebarService=p(X);deviceService=p(Y);locationStrategy=p(be);ogDataSignal=w(null);loadingOg=w(!0);constructor(){let t=localStorage.getItem("votedItems");t&&this.votedItems.set(new Set(JSON.parse(t)))}ngOnInit(){this.ogData?(this.ogDataSignal.set(this.ogData),this.loadingOg.set(!1)):this.story?.url&&!this.isTextPost()?(this.loadingOg.set(!0),this.ogService.getOpenGraphData(this.story.url).subscribe({next:t=>{this.ogDataSignal.set(t),this.loadingOg.set(!1)},error:()=>{this.loadingOg.set(!1)}})):this.loadingOg.set(!1)}hasVoted=K(()=>this.votedItems().has(this.story?.id||0));getDomain(t){if(!t)return"";try{return new URL(t).hostname.replace("www.","")}catch{return""}}getTimeAgo(t){let i=Math.floor(Date.now()/1e3-t),e=Math.floor(i/60),r=Math.floor(e/60),o=Math.floor(r/24);return o>0?`${o} day${o>1?"s":""} ago`:r>0?`${r} hour${r>1?"s":""} ago`:e>0?`${e} minute${e>1?"s":""} ago`:"just now"}upvote(){if(this.hasVoted())return;let t=new Set(this.votedItems());t.add(this.story.id),this.votedItems.set(t),localStorage.setItem("votedItems",JSON.stringify(Array.from(t)))}isTextPost(){let t=this.story?.title||"";return!this.story?.url||t.startsWith("Ask HN:")||t.startsWith("Tell HN:")||t.startsWith("Show HN:")&&!this.story?.url}searchByDomain(t){t.preventDefault(),t.stopPropagation();let i=this.getDomain(this.story.url);i&&this.router.navigate(["/search"],{queryParams:{q:`site:${i}`}})}showShareMenu=!1;copiedStory=!1;copiedComments=!1;canUseWebShare=K(()=>"share"in navigator&&typeof navigator.share=="function");getStoryShareText=K(()=>this.copiedStory?"\u2713 Copied!":this.canUseWebShare()?"Share Story":"Copy Story Link");getCommentsShareText=K(()=>this.copiedComments?"\u2713 Copied!":this.canUseWebShare()?"Share Comments":"Copy Comments Link");isVisited(){return this.visitedService.isVisited(this.story.id)}hasNewComments(){return this.visitedService.hasNewComments(this.story.id,this.story.descendants||0)}getNewCommentCount(){return this.visitedService.getNewCommentCount(this.story.id,this.story.descendants||0)}markAsVisited(){this.visitedService.markAsVisited(this.story.id,this.story.descendants)}toggleShareMenu(t){t.preventDefault(),t.stopPropagation(),this.showShareMenu=!this.showShareMenu,this.showShareMenu&&setTimeout(()=>{let i=e=>{e.target.closest(".relative")||(this.showShareMenu=!1,document.removeEventListener("click",i))};document.addEventListener("click",i)},0)}shareStory(){return P(this,null,function*(){let t=this.story.url||`https://news.ycombinator.com/item?id=${this.story.id}`,i={title:this.story.title,url:t};if(navigator.share&&this.canShare(i))try{yield navigator.share(i),this.showShareMenu=!1;return}catch(e){e.name!=="AbortError"&&console.log("Share failed, falling back to clipboard")}navigator.clipboard.writeText(t).then(()=>{this.copiedStory=!0,this.copiedComments=!1,setTimeout(()=>{this.copiedStory=!1,this.showShareMenu=!1},1500)}).catch(e=>{console.error("Failed to copy: ",e)})})}shareComments(){return P(this,null,function*(){let t=`${window.location.origin}/item/${this.story.id}`,i={title:`${this.story.title} - Comments`,text:"Discussion on HNews",url:t};if(navigator.share&&this.canShare(i))try{yield navigator.share(i),this.showShareMenu=!1;return}catch(e){e.name!=="AbortError"&&console.log("Share failed, falling back to clipboard")}navigator.clipboard.writeText(t).then(()=>{this.copiedComments=!0,this.copiedStory=!1,setTimeout(()=>{this.copiedComments=!1,this.showShareMenu=!1},1500)}).catch(e=>{console.error("Failed to copy: ",e)})})}canShare(t){let i=navigator;return typeof i.canShare=="function"?i.canShare(t):!0}openComments(t){if(!this.deviceService.isDesktop()){this.router.navigate(["/item",this.story.id]),this.markAsVisited();return}let i=t.shiftKey,e=t.metaKey,r=t.ctrlKey;if(i||e||r){let o=this.locationStrategy.prepareExternalUrl(`/item/${this.story.id}`),m=`${window.location.origin}${o}`;window.open(m,"_blank")}else t.preventDefault(),this.sidebarService.toggleSidebar(this.story.id),this.markAsVisited()}getCommentTooltip(){return this.deviceService.shouldShowKeyboardHints()?`View comments (${this.deviceService.getModifierKey()}+Click for new window)`:"View comments"}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=I({type:n,selectors:[["app-story-item"]],inputs:{story:"story",index:"index",ogData:"ogData"},decls:42,vars:54,consts:[["role","article",1,"relative","flex","flex-col","sm:flex-row","bg-white","border","border-gray-200","rounded-lg","shadow-sm","hover:shadow-md","transition-shadow","duration-200","mb-3","overflow-hidden"],[1,"absolute","top-0","right-0","w-0","h-0","border-t-[20px]","border-t-blue-600","border-l-[20px]","border-l-transparent",3,"title"],[1,"flex","sm:hidden","items-stretch","w-full"],[1,"flex","items-center","justify-between","px-3","py-3","bg-gradient-to-r","from-blue-50","to-blue-100","rounded-t-lg","w-full","overflow-hidden"],[1,"flex","items-center","gap-3"],[1,"hover:scale-110","transition-transform","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","p-1",3,"click","disabled","title"],["fill","currentColor","viewBox","0 0 20 20","aria-hidden","true",1,"w-6","h-6"],["d","M10 3L3 10h4v7h6v-7h4L10 3z"],[1,"text-xl","font-bold"],[1,"hidden","sm:flex","flex-col","items-center","justify-center","px-4","py-3","bg-gradient-to-b","from-blue-50","to-blue-100","rounded-l-lg","w-[100px]","flex-shrink-0"],["fill","currentColor","viewBox","0 0 20 20","aria-hidden","true",1,"w-8","h-8"],[1,"text-2xl","font-bold"],[1,"hidden","sm:flex","flex-shrink-0","w-28","items-center","justify-center","p-3"],[3,"linkClicked","storyUrl","storyTitle","ogData","loading","isTextPost"],[1,"flex-1","p-3","min-w-0","overflow-hidden"],[1,"flex","items-start","justify-between","gap-2"],[1,"flex-1","min-w-0","overflow-hidden"],[1,"text-base","sm:text-lg","font-semibold","mb-1","break-words"],["target","_blank","rel","noopener noreferrer nofollow",1,"hover:text-blue-600","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"href"],[1,"hover:text-blue-600","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"routerLink"],["type","button",1,"inline-block","text-xs","sm:text-sm","text-gray-500","hover:text-blue-600","hover:underline","cursor-pointer","break-all",3,"title"],[1,"hidden","sm:block","text-sm","text-gray-600","mt-1","truncate"],[1,"flex","flex-wrap","items-center","gap-x-2","gap-y-1","mt-2","text-xs","sm:text-sm","text-gray-600","overflow-hidden"],["aria-hidden","true",1,"hidden","sm:inline"],["type","button",1,"text-blue-600","hover:underline","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","keyup.enter","keyup.space","title"],[1,"text-gray-500","text-xs","ml-1"],[1,"relative","ml-2","sm:ml-0","flex-shrink-0"],[1,"p-1","sm:p-2","text-gray-500","hover:text-blue-600","hover:bg-gray-100","rounded","transition-colors","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"w-4","h-4","sm:w-5","sm:h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"],[1,"absolute","right-0","mt-2","w-48","bg-white","rounded-lg","shadow-lg","border","border-gray-200","z-10"],["target","_blank","rel","noopener noreferrer nofollow",1,"hover:text-blue-600","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","href"],[1,"hover:text-blue-600","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded",3,"click","routerLink"],["type","button",1,"inline-block","text-xs","sm:text-sm","text-gray-500","hover:text-blue-600","hover:underline","cursor-pointer","break-all",3,"click","keyup.enter","keyup.space","title"],[3,"username"],[1,"w-full","px-4","py-2","text-left","text-sm","text-gray-700","hover:bg-gray-100","rounded-t-lg","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-inset","focus-visible:ring-blue-500",3,"click"],[1,"w-full","px-4","py-2","text-left","text-sm","text-gray-700","hover:bg-gray-100","rounded-b-lg","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-inset","focus-visible:ring-blue-500",3,"click"]],template:function(i,e){if(i&1&&(a(0,"article",0),g(1,Ae,1,1,"div",1),a(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),y("click",function(){return e.upvote()}),U(),a(6,"svg",6),_(7,"path",7),l()(),ce(),a(8,"span",8),d(9),l()()()(),a(10,"div",9)(11,"button",5),y("click",function(){return e.upvote()}),U(),a(12,"svg",10),_(13,"path",7),l()(),ce(),a(14,"span",11),d(15),l()(),a(16,"div",12)(17,"app-story-thumbnail",13),y("linkClicked",function(){return e.markAsVisited()}),l()(),a(18,"div",14)(19,"div",15)(20,"div",16)(21,"h2",17),g(22,Re,2,2,"a",18)(23,Ue,2,4,"a",19),l(),g(24,Fe,2,3,"button",20),g(25,qe,2,1,"p",21),a(26,"div",22),g(27,je,3,1,"span"),a(28,"span",23),d(29,"\u2022"),l(),a(30,"span"),d(31),l(),a(32,"span",23),d(33,"\u2022"),l(),a(34,"button",24),y("click",function(o){return e.openComments(o)})("keyup.enter",function(o){return e.openComments(o)})("keyup.space",function(o){return e.openComments(o)}),d(35),g(36,He,2,1,"span",25),l()()(),a(37,"div",26)(38,"button",27),y("click",function(o){return e.toggleShareMenu(o)}),U(),a(39,"svg",28),_(40,"path",29),l()(),g(41,Be,5,2,"div",30),l()()()()),i&2){let r;s(),f(e.isVisited()?1:-1),s(4),N("text-blue-600",!e.hasVoted())("text-gray-400",e.hasVoted())("opacity-50",e.hasVoted()),v("disabled",e.hasVoted())("title",e.hasVoted()?"Already upvoted":"Upvote story"),F("aria-label",e.hasVoted()?"Already upvoted":"Upvote story")("aria-pressed",e.hasVoted()),s(3),N("text-blue-600",!e.hasVoted())("text-gray-500",e.hasVoted()),s(),M(" ",(e.story.score||0)+(e.hasVoted()?1:0)," "),s(2),N("text-blue-600",!e.hasVoted())("text-gray-400",e.hasVoted())("opacity-50",e.hasVoted()),v("disabled",e.hasVoted())("title",e.hasVoted()?"Already upvoted":"Upvote story"),F("aria-label",e.hasVoted()?"Already upvoted":"Upvote story")("aria-pressed",e.hasVoted()),s(3),N("text-blue-600",!e.hasVoted())("text-gray-500",e.hasVoted()),s(),M(" ",(e.story.score||0)+(e.hasVoted()?1:0)," "),s(2),v("storyUrl",e.story.url)("storyTitle",e.story.title||"")("ogData",e.ogDataSignal())("loading",e.loadingOg())("isTextPost",e.isTextPost()),s(4),N("text-gray-900",!e.isVisited())("text-gray-600",e.isVisited()),s(),f(e.story.url?22:23),s(2),f(e.story.url&&e.getDomain(e.story.url)?24:-1),s(),f((r=e.ogDataSignal())!=null&&r.description?25:-1),s(2),f(e.story.by?27:-1),s(4),Q(e.getTimeAgo(e.story.time)),s(3),v("title",e.getCommentTooltip()),F("aria-label","View "+(e.story.descendants||0)+" comments"),s(),fe(" ",e.story.descendants||0," ",e.story.descendants===1?"comment":"comments"," "),s(),f(e.hasNewComments()?36:-1),s(2),v("title","Share story or comments"),F("aria-label","Share story")("aria-expanded",e.showShareMenu),s(3),f(e.showShareMenu?41:-1)}},dependencies:[E,xe,De,ee],encapsulation:2})};var re=class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=I({type:n,selectors:[["app-story-skeleton"]],decls:17,vars:0,consts:[[1,"relative","flex","bg-white","border","border-gray-200","rounded-lg","shadow-sm","mb-3","animate-pulse"],[1,"flex","flex-col","items-center","justify-center","px-4","py-3","bg-gradient-to-b","from-gray-100","to-gray-200","rounded-l-lg","w-[100px]","flex-shrink-0"],[1,"w-8","h-8","bg-gray-300","rounded","mb-2"],[1,"w-12","h-6","bg-gray-300","rounded"],[1,"flex-shrink-0","w-28","flex","items-center","justify-center","p-3"],[1,"w-20","h-20","bg-gray-200"],[1,"flex-1","p-3"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"h-5","bg-gray-200","rounded","w-3/4","mb-2"],[1,"h-4","bg-gray-200","rounded","w-32","mb-2"],[1,"h-4","bg-gray-200","rounded","w-full","mb-3"],[1,"flex","items-center","gap-3"],[1,"h-3","bg-gray-200","rounded","w-20"],[1,"h-3","bg-gray-200","rounded","w-24"],[1,"h-3","bg-gray-200","rounded","w-28"],[1,"w-9","h-9","bg-gray-200","rounded"]],template:function(i,e){i&1&&(S(0,"article",0)(1,"div",1),L(2,"div",2)(3,"div",3),T(),S(4,"div",4),L(5,"div",5),T(),S(6,"div",6)(7,"div",7)(8,"div",8),L(9,"div",9)(10,"div",10)(11,"div",11),S(12,"div",12),L(13,"div",13)(14,"div",14)(15,"div",15),T()(),L(16,"div",16),T()()())},dependencies:[E],encapsulation:2})};var $e=()=>[1,2,3,4,5,6],ze=(n,t)=>t.id;function Ke(n,t){n&1&&_(0,"app-story-skeleton")}function We(n,t){n&1&&(a(0,"div",1),me(1,Ke,1,0,"app-story-skeleton",null,ge),l()),n&2&&(s(),de(ve(0,$e)))}function Ze(n,t){if(n&1){let i=x();a(0,"div",2)(1,"p"),d(2),l(),a(3,"button",8),y("click",function(){u(i);let r=c();return h(r.refresh())}),d(4," Try again "),l()()}if(n&2){let i=c();s(2),Q(i.error())}}function Qe(n,t){if(n&1&&_(0,"app-story-item",4),n&2){let i=t.$implicit,e=t.$index,r=c();v("story",i)("index",e+1)("ogData",r.getOpenGraphForStory(i))}}function Xe(n,t){if(n&1){let i=x();a(0,"div",5)(1,"button",9),y("click",function(){u(i);let r=c();return h(r.loadMore())}),d(2," Load More Stories "),l()()}}function Ye(n,t){n&1&&(a(0,"div",6),_(1,"div",10),a(2,"span",11),d(3,"Loading more stories..."),l()())}function Je(n,t){n&1&&(a(0,"div",7)(1,"p"),d(2,"No more stories to load"),l()())}var ne=class n{storyType="top";pageSize=30;hnService=p(ke);ogService=p(j);sidebarService=p(X);deviceService=p(Y);stories=w([]);loading=w(!0);error=w(null);currentPage=w(0);totalStoryIds=w([]);openGraphData=w(new Map);ngOnInit(){this.loadStories()}loadStories(){this.loading.set(!0),this.error.set(null),this.getStoryIds().pipe(G(t=>{this.totalStoryIds.set(t);let i=this.currentPage()*this.pageSize,e=i+this.pageSize,r=t.slice(i,e);return this.hnService.getItems(r)}),O(t=>t.filter(i=>i!==null)),le(t=>{let i=t.filter(e=>e.url&&!this.isTextPost(e)).map(e=>e.url);i.length>0&&this.ogService.getOpenGraphDataBatch(i).subscribe({next:e=>{this.openGraphData.update(r=>{let o=new Map(r);return e.forEach((m,C)=>{o.set(C,m)}),o})},error:e=>{console.error("Error fetching OpenGraph data:",e)}})})).subscribe({next:t=>{this.stories.set(t),this.loading.set(!1)},error:t=>{this.error.set("Failed to load stories. Please try again."),this.loading.set(!1),console.error("Error loading stories:",t)}})}getStoryIds(){switch(this.storyType){case"top":return this.hnService.getTopStories();case"best":return this.hnService.getBestStories();case"new":return this.hnService.getNewStories();case"ask":return this.hnService.getAskStories();case"show":return this.hnService.getShowStories();case"job":return this.hnService.getJobStories();default:return this.hnService.getTopStories()}}loadMore(){if(!this.hasMore())return;this.currentPage.update(r=>r+1),this.loading.set(!0);let t=this.currentPage()*this.pageSize,i=t+this.pageSize,e=this.totalStoryIds().slice(t,i);this.hnService.getItems(e).pipe(O(r=>r.filter(o=>o!==null)),le(r=>{let o=r.filter(m=>m.url&&!this.isTextPost(m)).map(m=>m.url);o.length>0&&this.ogService.getOpenGraphDataBatch(o).subscribe({next:m=>{this.openGraphData.update(C=>{let k=new Map(C);return m.forEach((b,D)=>{k.set(D,b)}),k})},error:m=>{console.error("Error fetching OpenGraph data:",m)}})})).subscribe({next:r=>{this.stories.update(o=>[...o,...r]),this.loading.set(!1)},error:r=>{this.error.set("Failed to load more stories."),this.loading.set(!1),console.error("Error loading more stories:",r)}})}hasMore(){return(this.currentPage()+1)*this.pageSize<this.totalStoryIds().length}refresh(){this.currentPage.set(0),this.stories.set([]),this.openGraphData.set(new Map),this.loadStories()}isTextPost(t){let i=t?.title||"";return!t?.url||i.startsWith("Ask HN:")||i.startsWith("Tell HN:")||i.startsWith("Show HN:")&&!t?.url}getOpenGraphForStory(t){return t.url?this.openGraphData().get(t.url):void 0}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=I({type:n,selectors:[["app-story-list"]],inputs:{storyType:"storyType",pageSize:"pageSize"},decls:9,vars:7,consts:[[1,"transition-all","duration-300"],["role","status","aria-live","polite","aria-label","Loading stories"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg","mb-4"],[1,"space-y-2","sm:space-y-3"],[3,"story","index","ogData"],[1,"text-center","mt-8"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center","py-8","text-gray-500"],[1,"mt-2","text-sm","underline","hover:no-underline","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","rounded","px-1",3,"click"],["aria-label","Load more stories",1,"px-4","py-2","sm:px-6","sm:py-3","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","duration-200","font-medium","cursor-pointer","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-offset-2","focus-visible:ring-blue-500","text-sm","sm:text-base",3,"click"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"ml-3","text-gray-600"]],template:function(i,e){i&1&&(a(0,"app-page-container",0),g(1,We,3,1,"div",1),g(2,Ze,5,1,"div",2),a(3,"div",3),me(4,Qe,1,3,"app-story-item",4,ze),l(),g(6,Xe,3,0,"div",5),g(7,Ye,4,0,"div",6),g(8,Je,3,0,"div",7),l()),i&2&&(N("lg:w-[60vw]",e.sidebarService.isOpen()&&e.deviceService.isDesktop()),s(),f(e.loading()&&e.stories().length===0?1:-1),s(),f(e.error()?2:-1),s(2),de(e.stories()),s(2),f(e.hasMore()&&!e.loading()?6:-1),s(),f(e.loading()&&e.stories().length>0?7:-1),s(),f(!e.hasMore()&&e.stories().length>0?8:-1))},dependencies:[E,ie,re,Te],encapsulation:2})};var Me=class n{route=p(_e);storyType="top";ngOnInit(){this.route.data.subscribe(t=>{this.storyType=t.type||"top"})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=I({type:n,selectors:[["app-stories"]],decls:1,vars:1,consts:[[3,"storyType"]],template:function(i,e){i&1&&_(0,"app-story-list",0),i&2&&v("storyType",e.storyType)},dependencies:[E,ne],encapsulation:2})};export{Me as StoriesComponent};
